<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Country-driven global mapping approach | index.split</title>
  <meta name="description" content="The GSSmap Technical Manual" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Country-driven global mapping approach | index.split" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The GSSmap Technical Manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Country-driven global mapping approach | index.split" />
  
  <meta name="twitter:description" content="The GSSmap Technical Manual" />
  

<meta name="author" content="MAPPING OF SALT-AFFECTED SOILS - Technical manual, Rome, 2020" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preparation-for-multiscale-mapping-of-salt-affected-soils.html"/>
<link rel="next" href="section-three-information-sharing-and-resources-mobilization.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Authors and contributos</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="executive-summary.html"><a href="executive-summary.html"><i class="fa fa-check"></i>Executive Summary</a><ul>
<li class="chapter" data-level="" data-path="executive-summary.html"><a href="executive-summary.html#background"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="executive-summary.html"><a href="executive-summary.html#resource-mobilization"><i class="fa fa-check"></i>Resource mobilization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="section-one-background-information.html"><a href="section-one-background-information.html"><i class="fa fa-check"></i>SECTION ONE - BACKGROUND INFORMATION</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#presentation"><i class="fa fa-check"></i><b>1.1</b> Presentation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html"><i class="fa fa-check"></i><b>2</b> Characteristics of salt-affected soils</a><ul>
<li class="chapter" data-level="2.1" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#genesis-of-salt-affected-soils"><i class="fa fa-check"></i><b>2.1</b> Genesis of salt-affected soils</a><ul>
<li class="chapter" data-level="2.1.1" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#direct-deposit-model"><i class="fa fa-check"></i><b>2.1.1</b> Direct deposit model</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#characteristics"><i class="fa fa-check"></i><b>2.2</b> Characteristics</a></li>
<li class="chapter" data-level="2.3" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#indicators-for-assessing-salt-affected-soils"><i class="fa fa-check"></i><b>2.3</b> Indicators for assessing salt-affected soils</a></li>
<li class="chapter" data-level="2.4" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#drivers-of-salt-problems-in-the-soil"><i class="fa fa-check"></i><b>2.4</b> Drivers of salt problems in the soil</a><ul>
<li class="chapter" data-level="2.4.1" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#primary-drivers"><i class="fa fa-check"></i><b>2.4.1</b> Primary drivers</a></li>
<li class="chapter" data-level="2.4.2" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#secondary-drivers"><i class="fa fa-check"></i><b>2.4.2</b> Secondary drivers</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#classification-of-salt-affected-soils"><i class="fa fa-check"></i><b>2.5</b> Classification of salt-affected soils</a></li>
<li class="chapter" data-level="2.6" data-path="characteristics-of-salt-affected-soils.html"><a href="characteristics-of-salt-affected-soils.html#global-distribution-of-salt-affected-soil"><i class="fa fa-check"></i><b>2.6</b> Global distribution of salt-affected soil</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html"><i class="fa fa-check"></i><b>3</b> Methods for mapping salt-affected soils</a><ul>
<li class="chapter" data-level="3.1" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#methods-based-on-soil-maps-and-expert-opinion"><i class="fa fa-check"></i><b>3.1</b> Methods based on soil maps and expert opinion</a></li>
<li class="chapter" data-level="3.2" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#using-remote-sensing-application"><i class="fa fa-check"></i><b>3.2</b> Using remote sensing application</a></li>
<li class="chapter" data-level="3.3" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#methods-based-on-soil-indicators-of-salts"><i class="fa fa-check"></i><b>3.3</b> Methods based on soil indicators of salts</a></li>
<li class="chapter" data-level="3.4" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#data-requirements-for-mapping-soil-salinity"><i class="fa fa-check"></i><b>3.4</b> Data requirements for mapping soil salinity</a><ul>
<li class="chapter" data-level="3.4.1" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#measured-soil-properties"><i class="fa fa-check"></i><b>3.4.1</b> Measured soil properties</a></li>
<li class="chapter" data-level="3.4.2" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#bulk-soil-properties-and-soil-maps"><i class="fa fa-check"></i><b>3.4.2</b> Bulk-soil properties and soil maps</a></li>
<li class="chapter" data-level="3.4.3" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#information-on-soil-forming-factors"><i class="fa fa-check"></i><b>3.4.3</b> Information on soil forming factors</a></li>
<li class="chapter" data-level="3.4.4" data-path="methods-for-mapping-salt-affected-soils.html"><a href="methods-for-mapping-salt-affected-soils.html#other-ancillary-data"><i class="fa fa-check"></i><b>3.4.4</b> Other ancillary data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="section-two-development-of-information-on-salt-affected-soils.html"><a href="section-two-development-of-information-on-salt-affected-soils.html"><i class="fa fa-check"></i>SECTION TWO - DEVELOPMENT OF INFORMATION ON SALT-AFFECTED SOILS</a></li>
<li class="chapter" data-level="4" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><i class="fa fa-check"></i><b>4</b> Preparation for multiscale mapping of salt-affected soils</a><ul>
<li class="chapter" data-level="4.1" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#requirements"><i class="fa fa-check"></i><b>4.1</b> Requirements</a><ul>
<li class="chapter" data-level="4.1.1" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#input-data"><i class="fa fa-check"></i><b>4.1.1</b> Input data</a></li>
<li class="chapter" data-level="4.1.2" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#computer-and-software"><i class="fa fa-check"></i><b>4.1.2</b> Computer and software</a></li>
<li class="chapter" data-level="4.1.3" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#example-input-data-for-demonstrating-spatial-mapping-of-salt-affected-soils"><i class="fa fa-check"></i><b>4.1.3</b> Example input data for demonstrating spatial mapping of salt-affected soils</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#software-requirements-for-multiscale-mapping-salt-affected-soils"><i class="fa fa-check"></i><b>4.2</b> Software requirements for multiscale mapping salt-affected soils</a><ul>
<li class="chapter" data-level="4.2.1" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#gis-application-requirements"><i class="fa fa-check"></i><b>4.2.1</b> GIS application requirements</a></li>
<li class="chapter" data-level="4.2.2" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#data-harmonization-requirements"><i class="fa fa-check"></i><b>4.2.2</b> Data harmonization requirements</a></li>
<li class="chapter" data-level="4.2.3" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#spatial-modelling-requirements"><i class="fa fa-check"></i><b>4.2.3</b> Spatial modelling requirements</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#input-data-preparation-for-mapping-salt-affected-soils"><i class="fa fa-check"></i><b>4.3</b> Input data preparation for mapping salt-affected soils</a><ul>
<li class="chapter" data-level="4.3.1" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#organizing-spreadsheet-data"><i class="fa fa-check"></i><b>4.3.1</b> Organizing spreadsheet data</a></li>
<li class="chapter" data-level="4.3.2" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#organizing-gis-layers"><i class="fa fa-check"></i><b>4.3.2</b> Organizing GIS layers</a></li>
<li class="chapter" data-level="4.3.3" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#harmonizing-input-gis-layers"><i class="fa fa-check"></i><b>4.3.3</b> Harmonizing input GIS layers</a></li>
<li class="chapter" data-level="4.3.4" data-path="preparation-for-multiscale-mapping-of-salt-affected-soils.html"><a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html#input-gis-database"><i class="fa fa-check"></i><b>4.3.4</b> Input GIS database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html"><i class="fa fa-check"></i><b>5</b> Country-driven global mapping approach</a><ul>
<li class="chapter" data-level="5.1" data-path="executive-summary.html"><a href="executive-summary.html#background"><i class="fa fa-check"></i><b>5.1</b> Background</a></li>
<li class="chapter" data-level="5.2" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#step-1-input-data-harmonization"><i class="fa fa-check"></i><b>5.2</b> Step 1: Input data harmonization</a><ul>
<li class="chapter" data-level="5.2.1" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#harmonizing-gis-layers"><i class="fa fa-check"></i><b>5.2.1</b> Harmonizing GIS layers</a></li>
<li class="chapter" data-level="5.2.2" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#harmonization-of-input-soil-data"><i class="fa fa-check"></i><b>5.2.2</b> Harmonization of input soil data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#step-2-spatial-modelling-of-indicators"><i class="fa fa-check"></i><b>5.3</b> Step 2: Spatial modelling of indicators</a><ul>
<li class="chapter" data-level="5.3.1" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#choosing-suitable-model"><i class="fa fa-check"></i><b>5.3.1</b> Choosing suitable model</a></li>
<li class="chapter" data-level="5.3.2" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#model-building-and-testing"><i class="fa fa-check"></i><b>5.3.2</b> Model building and testing</a></li>
<li class="chapter" data-level="5.3.3" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#spatial-prediction-and-uncertainty-assessment"><i class="fa fa-check"></i><b>5.3.3</b> Spatial prediction and uncertainty assessment</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#part-3-spatial-modelling-of-salt-affected-soils"><i class="fa fa-check"></i><b>5.4</b> Part 3: Spatial modelling of salt-affected soils</a><ul>
<li class="chapter" data-level="5.4.1" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#spatial-modelling-of-salt-affected-soils"><i class="fa fa-check"></i><b>5.4.1</b> Spatial modelling of salt-affected soils</a></li>
<li class="chapter" data-level="5.4.2" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#accuracy-assessment"><i class="fa fa-check"></i><b>5.4.2</b> Accuracy assessment</a></li>
<li class="chapter" data-level="5.4.3" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#uncertainty-assessment"><i class="fa fa-check"></i><b>5.4.3</b> Uncertainty assessment</a></li>
<li class="chapter" data-level="5.4.4" data-path="country-driven-global-mapping-approach.html"><a href="country-driven-global-mapping-approach.html#sampling-for-monitoring-and-gap-filling"><i class="fa fa-check"></i><b>5.4.4</b> Sampling for monitoring and gap filling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="section-three-information-sharing-and-resources-mobilization.html"><a href="section-three-information-sharing-and-resources-mobilization.html"><i class="fa fa-check"></i>SECTION THREE - INFORMATION SHARING AND RESOURCES MOBILIZATION</a></li>
<li class="chapter" data-level="6" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html"><i class="fa fa-check"></i><b>6</b> Product documentation and information sharing</a><ul>
<li class="chapter" data-level="6.1" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#product-documentation"><i class="fa fa-check"></i><b>6.1</b> Product documentation</a><ul>
<li class="chapter" data-level="6.1.1" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#cartographics-of-map-elements"><i class="fa fa-check"></i><b>6.1.1</b> Cartographics of map elements</a></li>
<li class="chapter" data-level="6.1.2" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#map-metafile"><i class="fa fa-check"></i><b>6.1.2</b> Map metafile</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#information-sharing"><i class="fa fa-check"></i><b>6.2</b> Information sharing</a></li>
<li class="chapter" data-level="6.3" data-path="executive-summary.html"><a href="executive-summary.html#resource-mobilization"><i class="fa fa-check"></i><b>6.3</b> Resource mobilization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#resource-mobilization-strategy"><i class="fa fa-check"></i><b>6.3.1</b> Resource mobilization strategy</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#technical-capacity-development-program-for-spatial-information-development"><i class="fa fa-check"></i><b>6.4</b> Technical capacity development program for spatial information development</a><ul>
<li class="chapter" data-level="6.4.1" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#program-overview"><i class="fa fa-check"></i><b>6.4.1</b> Program overview</a></li>
<li class="chapter" data-level="6.4.2" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#duration-and-requirements"><i class="fa fa-check"></i><b>6.4.2</b> Duration and requirements</a></li>
<li class="chapter" data-level="6.4.3" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#objectives-and-outcomes"><i class="fa fa-check"></i><b>6.4.3</b> Objectives and outcomes</a></li>
<li class="chapter" data-level="6.4.4" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#schedule"><i class="fa fa-check"></i><b>6.4.4</b> Schedule</a></li>
<li class="chapter" data-level="6.4.5" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#mode-of-delivery"><i class="fa fa-check"></i><b>6.4.5</b> Mode of delivery</a></li>
<li class="chapter" data-level="6.4.6" data-path="product-documentation-and-information-sharing.html"><a href="product-documentation-and-information-sharing.html#deliverables"><i class="fa fa-check"></i><b>6.4.6</b> Deliverables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="" data-path="appendices.html"><a href="appendices.html"><i class="fa fa-check"></i>Appendices</a><ul>
<li class="chapter" data-level="" data-path="appendices.html"><a href="appendices.html#appendix-a-example-image-download-from-usgs"><i class="fa fa-check"></i>Appendix A: Example image download from USGS</a></li>
<li class="chapter" data-level="" data-path="appendices.html"><a href="appendices.html#appendix-b-frequently-asked-questions-when-implementing-r"><i class="fa fa-check"></i>Appendix B: Frequently asked questions when implementing R</a></li>
<li class="chapter" data-level="" data-path="appendices.html"><a href="appendices.html#appendix-c-checking-for-correct-data-organization-in-excel"><i class="fa fa-check"></i>Appendix C: Checking for correct data organization in Excel</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="country-driven-global-mapping-approach" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Country-driven global mapping approach</h1>
<div id="background" class="section level2">
<h2><span class="header-section-number">5.1</span> Background</h2>
<p>The country-driven approach for mapping salt-affected soils is based on indicator mapping backed by drivers of salt-affected soils and models for classification of the salt problems. The approach integrates and borrows from the potential of other mapping methods. It also offers quantification of mapping accuracy and uncertainty, which are increasingly accepted by the soil science community as a standard practice. It also facilitates building of spatial information on indicators and drivers besides information on the status of salt-affected soils at multiple scales. However, these advantages come at the price of data demand. Some of the required input data such as soil indicators (ESP and Soluble ions) may not be readily available in many territories.
The country-driven global mapping is a three-step approach anchored on input data harmonization, spatial modelling of input soil indicators using spatial predictors, and classification of salt-affected soils (Figure 5.1).</p>
<div class="figure">
<img src="figures/images/Figure4.15.PNG" alt="" />
<p class="caption">Figure 5.1: Multiscale approach for national mapping salt-affected soils based on indicator maps</p>
</div>
<p>The approach puts emphasis on measured soil data (EC, pH, and ESP) as the primary soil indicators for classifying salt-affected soils. These input soil data are spatially modelled to produce maps of soil indicators of salt-affected soils. Appropriate classification schemes are selected to classify the indicator maps into maps of salt-affected soils (Figure 5.1).
R software and its contributed packages are the principal software for implementing the country-driven global mapping protocol. A summary of the key packages for implementing various steps of the protocol is given in Table 5.1. RStudio software (<a href="https://rstudio.com/products/rstudio/download/" class="uri">https://rstudio.com/products/rstudio/download/</a>) is used as an integrated development environment to support implementation of the packages in R.</p>
<p><em>Table 5.1: R packages and their application in multiscale mapping of salt-affected soils</em>
<img src="figures/tables/Table_5.1.png" />
These packages and their dependencies are installed using the following commands in R</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="country-driven-global-mapping-approach.html#cb1-1"></a><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;raster&quot;</span>, <span class="st">&quot;sp&quot;</span>, <span class="st">&quot;rgdal&quot;</span>, <span class="st">&quot;car&quot;</span>, <span class="st">&quot;carData&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;spacetime&quot;</span>, <span class="st">&quot;gstat&quot;</span>, <span class="st">&quot;automap&quot;</span>, <span class="st">&quot;randomForest&quot;</span>, <span class="st">&quot;fitdistrplus&quot;</span>, <span class="st">&quot;e1071&quot;</span>, <span class="st">&quot;caret&quot;</span>, <span class="st">&quot;soilassessment&quot;</span>, <span class="st">&quot;soiltexture&quot;</span>, <span class="st">&quot;GSIF&quot;</span>, <span class="st">&quot;aqp&quot;</span>, <span class="st">&quot;plyr&quot;</span>, <span class="st">&quot;Hmisc&quot;</span>, <span class="st">&quot;corrplot&quot;</span>, <span class="st">&quot;factoextra&quot;</span>, <span class="st">&quot;spup&quot;</span>, <span class="st">&quot;purrr&quot;</span>, <span class="st">&quot;lattice&quot;</span>, <span class="st">&quot;ncf&quot;</span>, <span class="st">&quot;npsurv&quot;</span>, <span class="st">&quot;lsei&quot;</span>, <span class="st">&quot;qrnn&quot;</span>, <span class="st">&quot;nnet&quot;</span>, <span class="st">&quot;mda&quot;</span>, <span class="st">&quot;RColorBrewer&quot;</span>, <span class="st">&quot;vcd&quot;</span>, <span class="st">&quot;readxls&quot;</span>,<span class="st">&quot;maptools&quot;</span>,<span class="st">&quot;neuralnet&quot;</span>,<span class="st">&quot;psych&quot;</span>))</span>
<span id="cb1-2"><a href="country-driven-global-mapping-approach.html#cb1-2"></a></span>
<span id="cb1-3"><a href="country-driven-global-mapping-approach.html#cb1-3"></a><span class="kw">library</span>(sp); <span class="kw">library</span>(foreign); <span class="kw">library</span>(rgdal); <span class="kw">library</span>(car);<span class="kw">library</span>(carData); <span class="kw">library</span>(maptools) <span class="kw">library</span>(spacetime); <span class="kw">library</span>(gstat); <span class="kw">library</span>(automap);<span class="kw">library</span>(randomForest);<span class="kw">library</span>(fitdistrplus); <span class="kw">library</span>(e1071); <span class="kw">library</span>(caret); <span class="kw">library</span>(raster); <span class="kw">library</span>(soilassessment); <span class="kw">library</span>(soiltexture); <span class="kw">library</span>(GSIF); <span class="kw">library</span>(aqp); <span class="kw">library</span>(plyr); <span class="kw">library</span>(Hmisc); <span class="kw">library</span>(corrplot); <span class="kw">library</span>(factoextra) <span class="kw">library</span>(spup); <span class="kw">library</span>(purrr); <span class="kw">library</span>(lattice);<span class="kw">library</span>(ncf);<span class="kw">library</span>(npsurv); <span class="kw">library</span>(lsei); <span class="kw">library</span>(nnet); <span class="kw">library</span>(class); <span class="kw">library</span>(mda); <span class="kw">library</span>(RColorBrewer); <span class="kw">library</span>(vcd); <span class="kw">library</span>(grid); <span class="kw">library</span>(neuralnet);<span class="kw">library</span>(readxl); <span class="kw">library</span>(psych);<span class="kw">library</span>(qrnn); <span class="kw">library</span>(dplyr)</span></code></pre></div>
<p>It is important to note the following points when implementing the mapping protocol in Figure 5.1 in R.</p>
<ul>
<li>R is a case-sensitive scripting software. More than 90% of its commands are scripted in a text- editor and executed by running the line/script.</li>
<li>Hash (#) denotes the beginning of a comment and is not executed by the software. Consequently, it can be used to insert comments in a line. All comments after hash (#) are colored green (like green traffic light) implying “pass” without execution.</li>
<li>Errors and warnings are given in red, while functions and number are given in blue and commands and variables are given in black.</li>
<li>When using RStudio text-editor, four panes are available in which the top left pane is the text editing window, top right pane is for data environment, bottom right pane is for display and help, and the bottom left is the console for executing the scripts.</li>
<li>Implemented scripts and reports (warning or errors) are shown in the console pane.</li>
<li>Some commands may run for some time and patience is recommended to enable the software to progress to completion. During such time, a red icon will be shown at the top left corner of the console pane.</li>
</ul>
</div>
<div id="step-1-input-data-harmonization" class="section level2">
<h2><span class="header-section-number">5.2</span> Step 1: Input data harmonization</h2>
<p>Input data harmonization at this point is carried out to: 1) harmonize soil indicators to those of saturated soil paste extract, 2) harmonize statistical distribution to normal distribution, and 3) harmonize soil depths at the interval of 0-30 cm, 30-100 cm, and 100-200 cm (and more depending on soil depths). These harmonization steps compliment those that were done during input data preparation.</p>
<div id="harmonizing-gis-layers" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Harmonizing GIS layers</h3>
<p>Begin by setting the working directory. This is a recommendation building on the previous database development in which the input processed data were saved in the output folder (c:/salinity/output) in Section 4.3.4.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="country-driven-global-mapping-approach.html#cb2-1"></a><span class="co"># Step 1-1: Import the data</span></span>
<span id="cb2-2"><a href="country-driven-global-mapping-approach.html#cb2-2"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/Salinity/Output&quot;</span>) <span class="co"># Setting the working directory</span></span>
<span id="cb2-3"><a href="country-driven-global-mapping-approach.html#cb2-3"></a>soil=<span class="kw">readOGR</span>(<span class="st">&quot;.&quot;</span>,<span class="st">&quot;soildata&quot;</span>) <span class="co"># Importing soildata.shp as shapefile</span></span></code></pre></div>
<p>Spreadsheet data can also be imported directly as excel data or CSV using appropriate commands such as</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="country-driven-global-mapping-approach.html#cb3-1"></a>soil =<span class="st"> </span><span class="kw">read_xlsx</span>(<span class="st">&quot;soildata.xlsx&quot;</span>) </span></code></pre></div>
<p>for importing MS Excel or</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="country-driven-global-mapping-approach.html#cb4-1"></a>soil=<span class="kw">read.csv</span>(<span class="st">&quot;soildata.csv&quot;</span>,<span class="dt">header=</span>T) </span></code></pre></div>
<p>for importing CSV filetype. GIS rater files are imported using either readGDAL or raster functions. Both functions accept many GIS raster file format such as geoTIF, ILWIS, ASCII, etc. When using the readGDAL function, the first instance is used to create a stack space for subsequent layers. Hence, it does not have “$” sign at the end of predictors and does not have “$band1” at the end of the import line. The function is unique since (1) it does not accept import and stack of layers of different dimensions in terms of spatial extent and pixel sizes and (2) it automatically creates a stack (here known as predictors) for input GIS layers. Subsequently, it is a preferred function for ensuring input data conformity. If the raster function is used, it may be necessary to resample the layers in case of possible differences in dimensions that may later introduce modelling errors. All imported input GIS layers should be named accordingly (dem, slope, ls, loncurve, cnbl, valley, rain, lcover, geology, pgeology, BBlue, BGreen, BRed, BIRed, swir1, swir2, etc.)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="country-driven-global-mapping-approach.html#cb5-1"></a>predictors=<span class="kw">readGDAL</span>(<span class="st">&quot;dem.tif&quot;</span>)</span>
<span id="cb5-2"><a href="country-driven-global-mapping-approach.html#cb5-2"></a>predictors<span class="op">$</span>slope=<span class="kw">readGDAL</span>(<span class="st">&quot;SLOPE.mpr&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-3"><a href="country-driven-global-mapping-approach.html#cb5-3"></a>predictors<span class="op">$</span>ls=<span class="kw">readGDAL</span>(<span class="st">&quot;ls.asc&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-4"><a href="country-driven-global-mapping-approach.html#cb5-4"></a>predictors<span class="op">$</span>valley=<span class="kw">readGDAL</span>(<span class="st">&quot;valley.mpr&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-5"><a href="country-driven-global-mapping-approach.html#cb5-5"></a>predictors<span class="op">$</span>geology=<span class="kw">readGDAL</span>(<span class="st">&quot;geology.mpr&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-6"><a href="country-driven-global-mapping-approach.html#cb5-6"></a></span>
<span id="cb5-7"><a href="country-driven-global-mapping-approach.html#cb5-7"></a></span>
<span id="cb5-8"><a href="country-driven-global-mapping-approach.html#cb5-8"></a></span>
<span id="cb5-9"><a href="country-driven-global-mapping-approach.html#cb5-9"></a>predictors<span class="op">$</span>BBlue=<span class="kw">readGDAL</span>(<span class="st">&quot;BBlue.mpr&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-10"><a href="country-driven-global-mapping-approach.html#cb5-10"></a>predictors<span class="op">$</span>swir1=<span class="kw">readGDAL</span>(<span class="st">&quot;swir1.asc&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-11"><a href="country-driven-global-mapping-approach.html#cb5-11"></a>predictors<span class="op">$</span>swir2=<span class="kw">readGDAL</span>(<span class="st">&quot;swir2.tif&quot;</span>)<span class="op">$</span>band1</span>
<span id="cb5-12"><a href="country-driven-global-mapping-approach.html#cb5-12"></a></span>
<span id="cb5-13"><a href="country-driven-global-mapping-approach.html#cb5-13"></a></span>
<span id="cb5-14"><a href="country-driven-global-mapping-approach.html#cb5-14"></a></span>
<span id="cb5-15"><a href="country-driven-global-mapping-approach.html#cb5-15"></a>predictors<span class="op">$</span>dem=predictors<span class="op">$</span>band1 <span class="co"># for replacing the first layer</span></span>
<span id="cb5-16"><a href="country-driven-global-mapping-approach.html#cb5-16"></a>predictors<span class="op">$</span>band1=<span class="ot">NULL</span> <span class="co"># for removing replaced layer</span></span>
<span id="cb5-17"><a href="country-driven-global-mapping-approach.html#cb5-17"></a><span class="co"># Step 1-2: Check the data for unique values and remove where possible</span></span>
<span id="cb5-18"><a href="country-driven-global-mapping-approach.html#cb5-18"></a><span class="kw">summary</span>(predictors)</span>
<span id="cb5-19"><a href="country-driven-global-mapping-approach.html#cb5-19"></a><span class="co"># Object of class SpatialGridDataFrame # Coordinates:</span></span>
<span id="cb5-20"><a href="country-driven-global-mapping-approach.html#cb5-20"></a><span class="co">#		min		max # x	-75674.99	417325</span></span>
<span id="cb5-21"><a href="country-driven-global-mapping-approach.html#cb5-21"></a><span class="co">#	y 1883692.11 2443692</span></span>
<span id="cb5-22"><a href="country-driven-global-mapping-approach.html#cb5-22"></a><span class="co"># Is projected: TRUE # proj4string :</span></span>
<span id="cb5-23"><a href="country-driven-global-mapping-approach.html#cb5-23"></a><span class="co"># [+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0] # Grid attributes:</span></span>
<span id="cb5-24"><a href="country-driven-global-mapping-approach.html#cb5-24"></a><span class="co">#	cellcentre.offset cellsize cells.dim # x		-75176 997.9757	494</span></span>
<span id="cb5-25"><a href="country-driven-global-mapping-approach.html#cb5-25"></a><span class="co"># y	1884191 998.2175	561</span></span>
<span id="cb5-26"><a href="country-driven-global-mapping-approach.html#cb5-26"></a><span class="co"># Data attributes:</span></span>
<span id="cb5-27"><a href="country-driven-global-mapping-approach.html#cb5-27"></a><span class="co">#	dem	loncurve	ls	cnbl</span></span>
<span id="cb5-28"><a href="country-driven-global-mapping-approach.html#cb5-28"></a><span class="co"># Min.	: 176.0		Min.	:-1.000e-07		Min.	:0.000002		Min.	:178.6 # 1st Qu.: 292.5	1st Qu.:-1.000e-07	1st Qu.:0.011727	1st Qu.:279.4</span></span>
<span id="cb5-29"><a href="country-driven-global-mapping-approach.html#cb5-29"></a><span class="co"># Median : 342.9  Median :-1.000e-07   Median :0.033486   Median :326.9 # Mean  : 349.7   Mean   : 1.170e-06   Mean   :0.053562   Mean   :332.3 # 3rd Qu.: 399.1  3rd Qu.: 1.149e-06   3rd Qu.:0.062155   3rd Qu.:380.0 # Max.   :1064.6   Max.   : 3.295e-04   Max.   :7.043770   Max.  :571.0</span></span>
<span id="cb5-30"><a href="country-driven-global-mapping-approach.html#cb5-30"></a><span class="co"># .....</span></span>
<span id="cb5-31"><a href="country-driven-global-mapping-approach.html#cb5-31"></a><span class="co">#    swir1	swir2	BBlue	BGreen</span></span>
<span id="cb5-32"><a href="country-driven-global-mapping-approach.html#cb5-32"></a></span>
<span id="cb5-33"><a href="country-driven-global-mapping-approach.html#cb5-33"></a><span class="co"># Min.	:0.008162	Min.	:0.002062	Min.	:0.009072	Min.	:0.01625</span></span>
<span id="cb5-34"><a href="country-driven-global-mapping-approach.html#cb5-34"></a><span class="co"># 1st Qu.:0.554471	1st Qu.:0.533823	1st Qu.:0.426480	1st Qu.:0.11551</span></span>
<span id="cb5-35"><a href="country-driven-global-mapping-approach.html#cb5-35"></a><span class="co"># Median :0.625109	Median :0.603396	Median :0.476060	Median :0.13294</span></span>
<span id="cb5-36"><a href="country-driven-global-mapping-approach.html#cb5-36"></a><span class="co"># Mean	:0.604679	Mean	:0.582251	Mean	:0.462953	Mean	:0.13189</span></span>
<span id="cb5-37"><a href="country-driven-global-mapping-approach.html#cb5-37"></a><span class="co"># 3rd Qu.:0.676205	3rd Qu.:0.650973	3rd Qu.:0.516825	3rd Qu.:0.15002</span></span>
<span id="cb5-38"><a href="country-driven-global-mapping-approach.html#cb5-38"></a><span class="co"># Max.	:0.868268	Max.	:0.838160	Max.	:0.679898	Max.	:0.22036</span></span>
<span id="cb5-39"><a href="country-driven-global-mapping-approach.html#cb5-39"></a></span>
<span id="cb5-40"><a href="country-driven-global-mapping-approach.html#cb5-40"></a><span class="co"># Remove NAs in case they occur due to data clipping</span></span>
<span id="cb5-41"><a href="country-driven-global-mapping-approach.html#cb5-41"></a>predictors<span class="op">$</span>slope=<span class="kw">ifelse</span>(<span class="kw">is.na</span>(predictors<span class="op">$</span>slope),<span class="kw">mean</span>(<span class="op">!</span><span class="kw">is.na</span>(predictors<span class="op">$</span>slope)),predi ctors<span class="op">$</span>slope)</span></code></pre></div>
<p>Statistical distribution of the GIS layers may also need to be checked if it requires harmonization. The histogram function (hist) is used to facilitate visual assessment for skew and need for normalization. In the case-study sample dataset, slope and rainfall layers showed skewed distribution and are normalized with square root and log-transformation, respectively. Other transformation models can be tested for other datasets.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="country-driven-global-mapping-approach.html#cb6-1"></a><span class="co"># Check for frequency distribution of the GIS layers</span></span>
<span id="cb6-2"><a href="country-driven-global-mapping-approach.html#cb6-2"></a><span class="kw">hist</span>(predictors<span class="op">@</span>data[,<span class="kw">c</span>(<span class="st">&quot;dem&quot;</span>,<span class="st">&quot;slope&quot;</span>,<span class="st">&quot;loncurve&quot;</span>,<span class="st">&quot;cnbl&quot;</span>,<span class="st">&quot;valley&quot;</span>,<span class="st">&quot;lcover&quot;</span>,<span class="st">&quot;rain&quot;</span>, <span class="st">&quot;geology&quot;</span>,<span class="st">&quot;pgeology&quot;</span>)])</span>
<span id="cb6-3"><a href="country-driven-global-mapping-approach.html#cb6-3"></a></span>
<span id="cb6-4"><a href="country-driven-global-mapping-approach.html#cb6-4"></a></span>
<span id="cb6-5"><a href="country-driven-global-mapping-approach.html#cb6-5"></a><span class="co"># Step 1-3: Derive the remote sensing indices</span></span></code></pre></div>
<p>Remote sensing image indices in Table 3.1 related to surface features/evidence of salt problems are determine using imageIndices function in the soilassessment package. It uses seven bands of the input remote sensing data, which should now be in the predictors stack of layers. They are specified in the script using the “$” symbol with the predictors.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="country-driven-global-mapping-approach.html#cb7-1"></a>predictors<span class="op">$</span>SI1=<span class="kw">imageIndices</span>(predictors<span class="op">$</span>BBlue,predictors<span class="op">$</span>BGreen,predictors<span class="op">$</span>BRed,predi ctors<span class="op">$</span>BIRed,predictors<span class="op">$</span>swir1,predictors<span class="op">$</span>swir2,<span class="st">&quot;SI1&quot;</span>)</span>
<span id="cb7-2"><a href="country-driven-global-mapping-approach.html#cb7-2"></a></span>
<span id="cb7-3"><a href="country-driven-global-mapping-approach.html#cb7-3"></a><span class="co">#	Min. 1st Qu.	Median	Mean 3rd Qu.	Max. # 0.03426 0.16152 0.18227 0.17972 0.20203 0.28645</span></span>
<span id="cb7-4"><a href="country-driven-global-mapping-approach.html#cb7-4"></a></span>
<span id="cb7-5"><a href="country-driven-global-mapping-approach.html#cb7-5"></a></span>
<span id="cb7-6"><a href="country-driven-global-mapping-approach.html#cb7-6"></a>predictors<span class="op">$</span>SI2=<span class="kw">imageIndices</span>(predictors<span class="op">$</span>BBlue,predictors<span class="op">$</span>BGreen,predictors<span class="op">$</span>BRed,predi ctors<span class="op">$</span>BIRed,predictors<span class="op">$</span>swir1,predictors<span class="op">$</span>swir2,<span class="st">&quot;SI2&quot;</span>);<span class="kw">summary</span>(predictors<span class="op">$</span>SI2)</span>
<span id="cb7-7"><a href="country-driven-global-mapping-approach.html#cb7-7"></a><span class="co">#	Min. 1st Qu.	Median	Mean 3rd Qu.	Max. # 0.02974 0.31104 0.34469 0.33663 0.37158 0.50973</span></span>
<span id="cb7-8"><a href="country-driven-global-mapping-approach.html#cb7-8"></a></span>
<span id="cb7-9"><a href="country-driven-global-mapping-approach.html#cb7-9"></a></span>
<span id="cb7-10"><a href="country-driven-global-mapping-approach.html#cb7-10"></a><span class="co"># Continue to complete all 13 image indices (see appendix A and Table 3.1)</span></span>
<span id="cb7-11"><a href="country-driven-global-mapping-approach.html#cb7-11"></a>predictors<span class="op">$</span>BI=<span class="kw">imageIndices</span>(predictors<span class="op">$</span>BBlue,predictors<span class="op">$</span>BGreen,predictors<span class="op">$</span>BRed,predic tors<span class="op">$</span>BIRed,predictors<span class="op">$</span>swir1,predictors<span class="op">$</span>swir2,<span class="st">&quot;BI&quot;</span>);<span class="kw">summary</span>(predictors<span class="op">$</span>BI)</span>
<span id="cb7-12"><a href="country-driven-global-mapping-approach.html#cb7-12"></a><span class="co">#	Min. 1st Qu.	Median		Mean 3rd Qu.		Max. # 0.1113	0.5757	0.6454	0.6302	0.7039	0.9405</span></span></code></pre></div>
<p>Any NAs produced during the calculation of the image indices can also be removed using the command in Step 1-2. Altogether, there are at least 13 layers of image indices produced. This number can be reduced using multivariate principal component analysis (PCA). The next step assesses statistical distribution of the image indices and harmonizes them to normal distribution, which is a prerequisite for PCA data reduction.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="country-driven-global-mapping-approach.html#cb8-1"></a><span class="co"># Step 1-4: assess statistical distribution and harmonize where necessary</span></span>
<span id="cb8-2"><a href="country-driven-global-mapping-approach.html#cb8-2"></a><span class="kw">hist</span>(predictors<span class="op">@</span>data[,<span class="dv">24</span><span class="op">:</span><span class="dv">29</span>]) <span class="co"># Figure 5.2</span></span>
<span id="cb8-3"><a href="country-driven-global-mapping-approach.html#cb8-3"></a><span class="kw">summary</span>(predictors<span class="op">$</span>SI6)</span>
<span id="cb8-4"><a href="country-driven-global-mapping-approach.html#cb8-4"></a><span class="co">#	Min.	1st Qu.	Median	Mean	3rd Qu.	Max. # 0.003647 0.940943 1.129692 1.068303 1.232106 1.663694</span></span>
<span id="cb8-5"><a href="country-driven-global-mapping-approach.html#cb8-5"></a></span>
<span id="cb8-6"><a href="country-driven-global-mapping-approach.html#cb8-6"></a>predictors<span class="op">$</span>BI=<span class="kw">sqrt</span>(predictors<span class="op">$</span>BI)</span>
<span id="cb8-7"><a href="country-driven-global-mapping-approach.html#cb8-7"></a></span>
<span id="cb8-8"><a href="country-driven-global-mapping-approach.html#cb8-8"></a><span class="kw">hist</span>(predictors<span class="op">$</span>BI)</span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.2.PNG" alt="" />
<p class="caption">Figure 5.2: Empirical statistical distribution of image indices from Sudanese case-study dataset</p>
</div>
<p>VSSI and BI image indices showed slight skew. Test with square-root transformation was found to adequately normalize the data. Although the transformation model is arbitrarily tested at this stage, it is better to use robust models such as the Box-Cox transformation (Box and Cox, 1964).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="country-driven-global-mapping-approach.html#cb9-1"></a><span class="co"># Step 1-5: Perform PCA and select the first PCs accounting for over 95% of the image indices&#39; variation</span></span>
<span id="cb9-2"><a href="country-driven-global-mapping-approach.html#cb9-2"></a></span>
<span id="cb9-3"><a href="country-driven-global-mapping-approach.html#cb9-3"></a><span class="co"># Extract the image layers</span></span>
<span id="cb9-4"><a href="country-driven-global-mapping-approach.html#cb9-4"></a>predicters=predictors<span class="op">@</span>data[,<span class="kw">c</span>(<span class="st">&quot;SI1&quot;</span>,<span class="st">&quot;SI2&quot;</span>,<span class="st">&quot;SI3&quot;</span>,<span class="st">&quot;SI4&quot;</span>,<span class="st">&quot;SI5&quot;</span>,<span class="st">&quot;SI6&quot;</span>,<span class="st">&quot;SAVI&quot;</span>,<span class="st">&quot;VSSI&quot;</span>,<span class="st">&quot;NDS I&quot;</span>,<span class="st">&quot;NDVI&quot;</span>,<span class="st">&quot;SR&quot;</span>,<span class="st">&quot;CRSI&quot;</span>, <span class="st">&quot;BI&quot;</span>)]</span>
<span id="cb9-5"><a href="country-driven-global-mapping-approach.html#cb9-5"></a>soil.cor=<span class="kw">cor</span>(predicters)</span>
<span id="cb9-6"><a href="country-driven-global-mapping-approach.html#cb9-6"></a><span class="kw">corrplot</span>(soil.cor,<span class="dt">method=</span><span class="st">&quot;number&quot;</span>,<span class="dt">number.cex =</span> <span class="fl">0.8</span>) <span class="co"># Figure 5.3a</span></span>
<span id="cb9-7"><a href="country-driven-global-mapping-approach.html#cb9-7"></a>pca&lt;-<span class="kw">prcomp</span>(predicters[], <span class="dt">scale=</span><span class="ot">TRUE</span>)</span>
<span id="cb9-8"><a href="country-driven-global-mapping-approach.html#cb9-8"></a><span class="kw">fviz_eig</span>(pca) <span class="co"># Figure 5.3b</span></span></code></pre></div>
<p>After normalizing the image indices, they are selected and converted into data-frame to enable determination of correlation and principal component analysis. Afterwards, the selected PCs are converted back to the raster stack.
The correlation plot (Figure 5.3b) shows the correlation between image indices. For example, SI1 and SI2 have a Pearson correlation index equal to 86%. PCA examines these correlations and determines the principal axes where data are highly correlated. These axes are also known as principal component (or dimensions in Figure 5.3b). Figure 5.3 is important in guiding the choice of PCs to represent the entire (13) layers of image indices.</p>
<div class="figure">
<img src="figures/images/Figure5.3.PNG" alt="" />
<p class="caption">Figure 5.3: Correlation of image indices and scree plot of their principal component</p>
</div>
<p>In Figure 5.3b, cumulative sum of the first 4 PCs (Dimensions) add up to more than 95% explained variation in the overall 13 layers of the image indices. Hence, the first 4 PCs can adequately represent the 13 image indices. This approach can be used on any set of image indices to select the appropriate number of PCs to reduce the data bulk.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="country-driven-global-mapping-approach.html#cb10-1"></a><span class="co"># Return the selected PCs to the raster stack to complete the harmonization process</span></span>
<span id="cb10-2"><a href="country-driven-global-mapping-approach.html#cb10-2"></a>Pred.pcs&lt;-<span class="kw">predict</span>(pca,predicters[])</span>
<span id="cb10-3"><a href="country-driven-global-mapping-approach.html#cb10-3"></a>predictors<span class="op">@</span>data<span class="op">$</span>PCA1=Pred.pcs[,<span class="dv">1</span>]</span>
<span id="cb10-4"><a href="country-driven-global-mapping-approach.html#cb10-4"></a>predictors<span class="op">@</span>data<span class="op">$</span>PCA2=Pred.pcs[,<span class="dv">2</span>]</span>
<span id="cb10-5"><a href="country-driven-global-mapping-approach.html#cb10-5"></a>predictors<span class="op">@</span>data<span class="op">$</span>PCA3=Pred.pcs[,<span class="dv">3</span>]</span>
<span id="cb10-6"><a href="country-driven-global-mapping-approach.html#cb10-6"></a>predictors<span class="op">@</span>data<span class="op">$</span>PCA4=Pred.pcs[,<span class="dv">4</span>]</span></code></pre></div>
</div>
<div id="harmonization-of-input-soil-data" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Harmonization of input soil data</h3>
<p>Many methods can be used to determine EC. They include (1) use of saturated soil paste extract, (2) using other soil extracts, (3) using pedoTransfer models from other soil properties, or (4) electromagnetic induction. Harmonization seeks to standardize methods 2 to 4 to the equivalent values in method 1, since popular classification schemes use values obtained by method 1.
(1) Example harmonization using known models in Table 3.5 (in Chapter3)</p>
<p>NB: This part is for the purposes of illustrating the steps for harmonizing EC. The case-study data indeed contains EC as obtained by the method of saturated soil paste extract and do not need harmonization. A quick look at the data structure is necessary to establish availability and format for target variables (EC, texture components, and organic carbon). The str function extracts the data structure.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="country-driven-global-mapping-approach.html#cb11-1"></a><span class="co"># Step 1-6a: Harmonize input indicator measurements to those for saturated soil paste extract</span></span>
<span id="cb11-2"><a href="country-driven-global-mapping-approach.html#cb11-2"></a><span class="co">#Step 1-6b: Load the library and import the soil data</span></span>
<span id="cb11-3"><a href="country-driven-global-mapping-approach.html#cb11-3"></a><span class="kw">str</span>(soil)</span>
<span id="cb11-4"><a href="country-driven-global-mapping-approach.html#cb11-4"></a></span>
<span id="cb11-5"><a href="country-driven-global-mapping-approach.html#cb11-5"></a><span class="co"># &#39;data.frame&#39;: 192 obs. of	14 variables:</span></span>
<span id="cb11-6"><a href="country-driven-global-mapping-approach.html#cb11-6"></a><span class="co"># $ Sample	: int	1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb11-7"><a href="country-driven-global-mapping-approach.html#cb11-7"></a><span class="co"># $ Pits	: int	1 1 2 3 4 5 6 6 7 8 ...</span></span>
<span id="cb11-8"><a href="country-driven-global-mapping-approach.html#cb11-8"></a><span class="co"># $ Longitude: num	62.2 62.2 62.2 62.2 62.2 ...</span></span>
<span id="cb11-9"><a href="country-driven-global-mapping-approach.html#cb11-9"></a><span class="co"># $ Latitude : num	30.2 30.2 30.2 30.2 30.2 ...</span></span>
<span id="cb11-10"><a href="country-driven-global-mapping-approach.html#cb11-10"></a><span class="co"># $ Upper	: int	0 20 0 0 0 0 0 40 0 0 ...</span></span>
<span id="cb11-11"><a href="country-driven-global-mapping-approach.html#cb11-11"></a><span class="co"># $ Lower	: int	20 100 30 30 30 30 40 100 30 40 ...</span></span>
<span id="cb11-12"><a href="country-driven-global-mapping-approach.html#cb11-12"></a><span class="co"># $ Horizon	: Factor w/ 2 levels &quot;A&quot;,&quot;B&quot;: 1 2 1 1 1 1 1 2 1 1 ...</span></span>
<span id="cb11-13"><a href="country-driven-global-mapping-approach.html#cb11-13"></a><span class="co"># $ EC	: num	1.16 1.63 0.499 0.295 0.161 0.8 1.85 0.938 0.167 0.141 ...</span></span>
<span id="cb11-14"><a href="country-driven-global-mapping-approach.html#cb11-14"></a><span class="co"># $ PH	: num	8.3 8.71 8.64 8.72 9.14 8.6 8.86	8.95	8.83	9.45	...</span></span>
<span id="cb11-15"><a href="country-driven-global-mapping-approach.html#cb11-15"></a><span class="co"># $ ESP	: num	3.61 7.16 2.76 2.26 1.56 ...				</span></span>
<span id="cb11-16"><a href="country-driven-global-mapping-approach.html#cb11-16"></a><span class="co"># $ Sand	: num	51 45.2 45.2 55.2 67.2 43.2 45.2	49.2	49.2	85.2	...</span></span>
<span id="cb11-17"><a href="country-driven-global-mapping-approach.html#cb11-17"></a><span class="co"># $ Silt	: num	38 44 39 32 20 44 39 36 31 2 ...				</span></span>
<span id="cb11-18"><a href="country-driven-global-mapping-approach.html#cb11-18"></a><span class="co"># $ Clay	: num	11 10.8 15.8 12.8 12.8 12.8 15.8	14.8	19.8	12.8	...</span></span>
<span id="cb11-19"><a href="country-driven-global-mapping-approach.html#cb11-19"></a><span class="co"># $ OC	: num	0.21 0.32 0.24 0.66 0.23 0.36 0.17 0.05 1.37 0.12 ...</span></span></code></pre></div>
<p>The data seems to have the required variables for harmonizing EC values. The first step in the harmonization is to derive the soil textural classes. The functions for deriving the soil textural classes do not accept NAs in the data. Hence, they must be clearly checked and removed from the list of variables containing the textural components. This is done by first creating a dummy column to sum the texture components and using this dummy to choose only data-entries without missing entries (i.e. NA). In the case-study dataset, the texture components appear in variables number 11 (Sand), 12 (Silt) and 13 (Clay) (Note that there are 14 variables all together).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="country-driven-global-mapping-approach.html#cb12-1"></a><span class="co">#Step 1-6c: Check for missing data and select only complete dataset</span></span>
<span id="cb12-2"><a href="country-driven-global-mapping-approach.html#cb12-2"></a><span class="kw">variable.names</span>(soil[<span class="dv">11</span>]); <span class="kw">variable.names</span>(soil[<span class="dv">12</span>]); <span class="kw">variable.names</span>(soil[<span class="dv">13</span>]);</span>
<span id="cb12-3"><a href="country-driven-global-mapping-approach.html#cb12-3"></a>soil<span class="op">$</span>dummy=<span class="st"> </span><span class="kw">rowSums</span>(soil[, <span class="dv">11</span><span class="op">:</span><span class="dv">13</span>])</span>
<span id="cb12-4"><a href="country-driven-global-mapping-approach.html#cb12-4"></a>soil1=<span class="kw">subset</span>(soil,<span class="op">!</span><span class="kw">is.na</span>(soil<span class="op">$</span>dummy))</span>
<span id="cb12-5"><a href="country-driven-global-mapping-approach.html#cb12-5"></a>soil1<span class="op">$</span>dummy=<span class="ot">NULL</span> <span class="co"># remove the dummy</span></span>
<span id="cb12-6"><a href="country-driven-global-mapping-approach.html#cb12-6"></a>soil0=<span class="kw">data.frame</span>(soil1)</span>
<span id="cb12-7"><a href="country-driven-global-mapping-approach.html#cb12-7"></a><span class="co">#Step 1-6c: Create and code the texture classes</span></span>
<span id="cb12-8"><a href="country-driven-global-mapping-approach.html#cb12-8"></a>SSCP=soil0[,<span class="kw">c</span>(<span class="st">&quot;Clay&quot;</span>,<span class="st">&quot;Silt&quot;</span>,<span class="st">&quot;Sand&quot;</span>)]</span>
<span id="cb12-9"><a href="country-driven-global-mapping-approach.html#cb12-9"></a><span class="kw">names</span>(SSCP) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;CLAY&#39;</span>, <span class="st">&#39;SILT&#39;</span>, <span class="st">&#39;SAND&#39;</span>)</span>
<span id="cb12-10"><a href="country-driven-global-mapping-approach.html#cb12-10"></a>SSCP =<span class="st"> </span><span class="kw">round</span>(SSCP, <span class="dv">2</span>)</span>
<span id="cb12-11"><a href="country-driven-global-mapping-approach.html#cb12-11"></a>SSCP_norm =<span class="st"> </span><span class="kw">TT.normalise.sum</span>(<span class="dt">tri.data =</span> SSCP[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">residuals =</span> T)</span>
<span id="cb12-12"><a href="country-driven-global-mapping-approach.html#cb12-12"></a><span class="kw">colnames</span>(SSCP_norm)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] =<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">colnames</span>(SSCP_norm)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>],<span class="st">&quot;_nm&quot;</span>)</span>
<span id="cb12-13"><a href="country-driven-global-mapping-approach.html#cb12-13"></a>SSCP =<span class="st"> </span><span class="kw">cbind</span>(SSCP, <span class="kw">round</span>(SSCP_norm, <span class="dv">2</span>))</span>
<span id="cb12-14"><a href="country-driven-global-mapping-approach.html#cb12-14"></a>SSCP<span class="op">$</span>CLAY=SSCP<span class="op">$</span>CLAY_nm;SSCP<span class="op">$</span>SILT=SSCP<span class="op">$</span>SILT_nm;SSCP<span class="op">$</span>SAND=SSCP<span class="op">$</span>SAND_nm</span>
<span id="cb12-15"><a href="country-driven-global-mapping-approach.html#cb12-15"></a><span class="kw">rm</span>(SSCP_norm)</span>
<span id="cb12-16"><a href="country-driven-global-mapping-approach.html#cb12-16"></a>soil0=<span class="kw">cbind</span>(soil0,<span class="st">&quot;TEXCLASS&quot;</span> =<span class="kw">TT.points.in.classes</span>(<span class="dt">tri.data =</span>SSCP[, <span class="kw">c</span>(<span class="st">&#39;CLAY&#39;</span>, <span class="st">&#39;SILT&#39;</span>, <span class="st">&#39;SAND&#39;</span>)],<span class="dt">class.sys =</span> <span class="st">&quot;USDA.TT&quot;</span>,	<span class="dt">PiC.type	=</span> <span class="st">&quot;t&quot;</span>,<span class="dt">collapse	=</span> <span class="st">&#39;, &#39;</span>))</span>
<span id="cb12-17"><a href="country-driven-global-mapping-approach.html#cb12-17"></a>soil0<span class="op">$</span>TEXCLASS=<span class="kw">as.factor</span>(soil0<span class="op">$</span>TEXCLASS)</span>
<span id="cb12-18"><a href="country-driven-global-mapping-approach.html#cb12-18"></a>soil0<span class="op">$</span>TEXCLASS1=<span class="kw">as.numeric</span>(soil0<span class="op">$</span>TEXCLASS)</span>
<span id="cb12-19"><a href="country-driven-global-mapping-approach.html#cb12-19"></a><span class="kw">summary</span>(soil0<span class="op">$</span>TEXCLASS)</span>
<span id="cb12-20"><a href="country-driven-global-mapping-approach.html#cb12-20"></a><span class="kw">rm</span>(SSCP)</span>
<span id="cb12-21"><a href="country-driven-global-mapping-approach.html#cb12-21"></a>soil0<span class="op">$</span>TEXCLASS=car<span class="op">::</span><span class="kw">recode</span>(soil0<span class="op">$</span>TEXCLASS,<span class="st">&quot;&#39;Lo, SiLo&#39;=&#39;SiLo&#39;&quot;</span>) <span class="co"># Here, the double classes are changed one at a time</span></span>
<span id="cb12-22"><a href="country-driven-global-mapping-approach.html#cb12-22"></a></span>
<span id="cb12-23"><a href="country-driven-global-mapping-approach.html#cb12-23"></a><span class="kw">summary</span>(soil0<span class="op">$</span>TEXCLASS)</span>
<span id="cb12-24"><a href="country-driven-global-mapping-approach.html#cb12-24"></a><span class="co">#Cl	Lo Lo, SiLo	LoSa	SaClLo	SaLo	SiLo</span></span>
<span id="cb12-25"><a href="country-driven-global-mapping-approach.html#cb12-25"></a><span class="co">#2	51	2	9	1	104	22</span></span>
<span id="cb12-26"><a href="country-driven-global-mapping-approach.html#cb12-26"></a></span>
<span id="cb12-27"><a href="country-driven-global-mapping-approach.html#cb12-27"></a>soil0<span class="op">$</span>TEXCLASS1=dplyr<span class="op">::</span><span class="kw">recode</span>(soil0<span class="op">$</span>TEXCLASS,<span class="dt">Cl=</span><span class="dv">1</span>, <span class="dt">ClLo =</span><span class="dv">7</span>, <span class="dt">Lo=</span><span class="dv">11</span>, <span class="dt">LoSa=</span><span class="dv">10</span>, <span class="dt">Sa=</span><span class="dv">12</span>, <span class="dt">SaCl=</span><span class="dv">8</span>, <span class="dt">SaClLo=</span><span class="dv">9</span>,<span class="dt">SaLo=</span><span class="dv">5</span>, <span class="dt">SiCl=</span><span class="dv">2</span>,<span class="dt">SiClLo=</span><span class="dv">3</span>,<span class="dt">SiLo=</span><span class="dv">4</span>,<span class="dt">Si=</span><span class="dv">6</span>,<span class="dt">CS=</span><span class="dv">13</span>,<span class="dt">MS=</span><span class="dv">14</span>,<span class="dt">HCL=</span><span class="dv">16</span>,<span class="dt">FS=</span><span class="dv">15</span>)</span>
<span id="cb12-28"><a href="country-driven-global-mapping-approach.html#cb12-28"></a></span>
<span id="cb12-29"><a href="country-driven-global-mapping-approach.html#cb12-29"></a><span class="kw">summary</span>(soil0<span class="op">$</span>TEXCLASS1)</span>
<span id="cb12-30"><a href="country-driven-global-mapping-approach.html#cb12-30"></a><span class="co">#Min.	1st Qu.	Median	Mean	3rd Qu.	Max.  1.000	5.000	5.000		6.691	11.000		11.000</span></span>
<span id="cb12-31"><a href="country-driven-global-mapping-approach.html#cb12-31"></a></span>
<span id="cb12-32"><a href="country-driven-global-mapping-approach.html#cb12-32"></a>soil1=soil0</span></code></pre></div>
<p>It is important to note again that the sample case-study variables were determined on saturated soil paste extract. Hence, the examples for harmonization given here are for the purpose of demonstrating script implementation. Suppose the EC was determined from 1:1 soil extract, then the following script is used to harmonize the EC values.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="country-driven-global-mapping-approach.html#cb13-1"></a><span class="co">#Step 1-6d: EC harmonization</span></span>
<span id="cb13-2"><a href="country-driven-global-mapping-approach.html#cb13-2"></a>soil1<span class="op">$</span>ECse1=<span class="kw">ECconversion1</span>(soil1<span class="op">$</span>EC,soil1<span class="op">$</span>OC,soil1<span class="op">$</span>Clay,soil1<span class="op">$</span>texture1,<span class="st">&quot;1:1&quot;</span>,<span class="st">&quot;FAO&quot;</span>)</span>
<span id="cb13-3"><a href="country-driven-global-mapping-approach.html#cb13-3"></a><span class="kw">summary</span>(soil1<span class="op">$</span>ECse1)</span>
<span id="cb13-4"><a href="country-driven-global-mapping-approach.html#cb13-4"></a></span>
<span id="cb13-5"><a href="country-driven-global-mapping-approach.html#cb13-5"></a><span class="co">#Min.	1st Qu.	Median	Mean	3rd Qu.	Max.	NA&#39;s</span></span>
<span id="cb13-6"><a href="country-driven-global-mapping-approach.html#cb13-6"></a><span class="co">#0.4912	2.0461	4.0769	10.5302	9.8501	108.8235	1</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Example harmonization using pedo Transfer function</li>
</ol>
<p>Pedo-transfer function (PTF) is a function for estimating soil property by utilizing functional relationship between this property (known as a target variable, such as ECSE) and other easy-to-measure soil variables such as texture, carbon, etc. Suppose a few samples have ECSE measurements, then a PTF is built between ECSE and the other soil properties. The PTF function is stored and later used to estimate ECSE for all (or future) samples in the study area. The soilassessment package has pedoTransfer function for building PTF. This function provides for alternative models such as linear, random forest, support vector machine, neural networks, etc. for modelling the relationship between the target soil variable and its predictors. The first term in the pedoTransfer function specifies the preferred model such as randomforest, svm, neuralnetwork, linear, etc. The second term specifies the dataframe containing the calibration dataset. This dataframe should not have NAs in any of the variables for developing the pedoTransfer model. The last terms are unlimited list of predictor variables, which are separated by comma. Their names should be like the variable names in the dataframe.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="country-driven-global-mapping-approach.html#cb14-1"></a><span class="co">#Step 1-6e: EC harmonization</span></span>
<span id="cb14-2"><a href="country-driven-global-mapping-approach.html#cb14-2"></a>soil2 =soil1[<span class="kw">sample</span>(<span class="kw">nrow</span>(soil1)), ][<span class="dv">1</span><span class="op">:</span>(<span class="kw">floor</span>((<span class="kw">nrow</span>(soil1)<span class="op">/</span><span class="dv">4</span>)<span class="op">*</span><span class="dv">1</span>)), ]</span>
<span id="cb14-3"><a href="country-driven-global-mapping-approach.html#cb14-3"></a>soil2=<span class="kw">subset</span>(soil2,<span class="op">!</span><span class="kw">is.na</span>(soil2<span class="op">$</span>ECse))</span>
<span id="cb14-4"><a href="country-driven-global-mapping-approach.html#cb14-4"></a>EC.ptf=<span class="st"> </span><span class="kw">pedoTrasnfer</span>(<span class="st">&quot;randomforest&quot;</span>,soil2,ECse,Sand,OC,Clay)</span>
<span id="cb14-5"><a href="country-driven-global-mapping-approach.html#cb14-5"></a>soil1<span class="op">$</span>ECpf=<span class="kw">predict</span>(EC.ptf, <span class="dt">newdata=</span>soil1) <span class="co">#to attach the harmonized ECSE equivalent</span></span>
<span id="cb14-6"><a href="country-driven-global-mapping-approach.html#cb14-6"></a><span class="kw">plot</span>(soil1<span class="op">$</span>ECse,soil1<span class="op">$</span><span class="st"> </span>ECpf)</span>
<span id="cb14-7"><a href="country-driven-global-mapping-approach.html#cb14-7"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>,<span class="dt">lty=</span><span class="dv">20</span>, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Example harmonization of apparent electrical conductivity of bulk soil</li>
</ol>
<p>Apparent electrical conductivity of bulk soil (ECa) is measured in the field using proximal sensors such as EMI. It’s possible to obtain many sampled data points with this EC measurement approach owing to its rapid nature. However, the measured ECa values need calibration with measured ECSE to harmonize them. The harmonization is a two-step process in which the calibration model is first build between selected samples with ECa and ECSE and then the model applied to the remaining ECa to estimate the equivalent ECSE. In the soilassessment package, the function ECconversion3 facilitates this kind of harmonization. The following scripts demonstrate how to use ECconversion3 to harmonize ECa with ECSE. A scatterplot of ECa with ECSE is important in guiding the choice for the link model. In the given example, a power relationship is assumed as the link model between ECa and ECSE (Figure 5.4). Other link options such as linear, exponential, logarithmic, etc. are also provided in the ECconversion3 (Omuto, 2020).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="country-driven-global-mapping-approach.html#cb15-1"></a><span class="co">#Step 1-6f: EC Harmonization</span></span>
<span id="cb15-2"><a href="country-driven-global-mapping-approach.html#cb15-2"></a><span class="kw">plot</span>(ECse<span class="op">~</span>ECa,soil2) <span class="co"># To choose a suitable predictive model #(Figure 5.4)</span></span>
<span id="cb15-3"><a href="country-driven-global-mapping-approach.html#cb15-3"></a>EC3.ml=<span class="kw">nls</span>(EC<span class="op">~</span><span class="kw">ECconversion3</span>(ECa,A,B,<span class="st">&quot;power&quot;</span>), <span class="dt">start=</span><span class="kw">c</span>(<span class="dt">A=</span><span class="fl">0.1</span>, <span class="dt">B=</span><span class="fl">0.8</span>), <span class="dt">data=</span>soil2)</span>
<span id="cb15-4"><a href="country-driven-global-mapping-approach.html#cb15-4"></a>soil<span class="op">$</span>ECse3=<span class="kw">ECconversion3</span>(soil<span class="op">$</span>EC, <span class="kw">coef</span>(EC3.ml)[<span class="dv">1</span>], <span class="kw">coef</span>(EC3.ml)[<span class="dv">2</span>],<span class="st">&quot;power&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.4.PNG" alt="" />
<p class="caption">Figure 5.4: Graphical illustration of relationship between apparent and measured EC</p>
</div>
<p>Soil depth harmonization aims at developing soil information for uniform depth throughout the soil data. Uniform depth facilitates comparison of salt problems down the profile and horizontally across the landscape. This harmonization is achieved with the depth-integrating spline approach (Bishop et al., 1999). The tool for implementing the approach is contained in the GSIF package (Hengl, 2019).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="country-driven-global-mapping-approach.html#cb16-1"></a><span class="co">#Step 1-7: Harmonizing soil depths</span></span>
<span id="cb16-2"><a href="country-driven-global-mapping-approach.html#cb16-2"></a></span>
<span id="cb16-3"><a href="country-driven-global-mapping-approach.html#cb16-3"></a>lon=soil1<span class="op">$</span>Longitude</span>
<span id="cb16-4"><a href="country-driven-global-mapping-approach.html#cb16-4"></a>lat=soil1<span class="op">$</span>Latitude</span>
<span id="cb16-5"><a href="country-driven-global-mapping-approach.html#cb16-5"></a>id=soil1<span class="op">$</span>Pits</span>
<span id="cb16-6"><a href="country-driven-global-mapping-approach.html#cb16-6"></a>top=soil1<span class="op">$</span>Upper</span>
<span id="cb16-7"><a href="country-driven-global-mapping-approach.html#cb16-7"></a>bottom=soil1<span class="op">$</span>Lower</span>
<span id="cb16-8"><a href="country-driven-global-mapping-approach.html#cb16-8"></a>horizon=soil1<span class="op">$</span>Horizon</span>
<span id="cb16-9"><a href="country-driven-global-mapping-approach.html#cb16-9"></a>ECdp=soil1<span class="op">$</span>EC</span>
<span id="cb16-10"><a href="country-driven-global-mapping-approach.html#cb16-10"></a>prof1=<span class="kw">join</span>(<span class="kw">data.frame</span>(id,top,bottom, ECdp, horizon),<span class="kw">data.frame</span>(id,lon,lat),<span class="dt">type=</span><span class="st">&quot;inn er&quot;</span>)</span>
<span id="cb16-11"><a href="country-driven-global-mapping-approach.html#cb16-11"></a></span>
<span id="cb16-12"><a href="country-driven-global-mapping-approach.html#cb16-12"></a></span>
<span id="cb16-13"><a href="country-driven-global-mapping-approach.html#cb16-13"></a><span class="kw">depths</span>(prof1)=id<span class="op">~</span>top<span class="op">+</span>bottom Warning message<span class="op">:</span></span>
<span id="cb16-14"><a href="country-driven-global-mapping-approach.html#cb16-14"></a>converting IDs from factor to character</span>
<span id="cb16-15"><a href="country-driven-global-mapping-approach.html#cb16-15"></a><span class="kw">site</span>(prof1)=<span class="er">~</span>lon<span class="op">+</span>lat</span>
<span id="cb16-16"><a href="country-driven-global-mapping-approach.html#cb16-16"></a><span class="kw">coordinates</span>(prof1) =<span class="st"> </span><span class="er">~</span>lon<span class="op">+</span>lat</span>
<span id="cb16-17"><a href="country-driven-global-mapping-approach.html#cb16-17"></a><span class="kw">proj4string</span>(prof1)=<span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span>)</span>
<span id="cb16-18"><a href="country-driven-global-mapping-approach.html#cb16-18"></a>depth.s =<span class="st"> </span><span class="kw">mpspline</span>(prof1, <span class="dt">var.name=</span> <span class="st">&quot;ECdp&quot;</span>, <span class="dt">lam=</span><span class="fl">0.8</span>,<span class="dt">d =</span> <span class="kw">t</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">100</span>,<span class="dv">150</span>))) </span>
<span id="cb16-19"><a href="country-driven-global-mapping-approach.html#cb16-19"></a></span>
<span id="cb16-20"><a href="country-driven-global-mapping-approach.html#cb16-20"></a><span class="kw">plot</span>(prof1, <span class="dt">color=</span> <span class="st">&quot;ECdp&quot;</span>, <span class="dt">name=</span><span class="st">&quot;horizon&quot;</span>,<span class="dt">color.palette =</span> <span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&#39;Accent&#39;</span></span>
<span id="cb16-21"><a href="country-driven-global-mapping-approach.html#cb16-21"></a>)),<span class="dt">par=</span><span class="kw">c</span>(<span class="dt">cex.lab=</span><span class="fl">2.0</span>)) <span class="co">#Figure 5.5</span></span>
<span id="cb16-22"><a href="country-driven-global-mapping-approach.html#cb16-22"></a></span>
<span id="cb16-23"><a href="country-driven-global-mapping-approach.html#cb16-23"></a></span>
<span id="cb16-24"><a href="country-driven-global-mapping-approach.html#cb16-24"></a>lon=soil1<span class="op">$</span>Longitude</span>
<span id="cb16-25"><a href="country-driven-global-mapping-approach.html#cb16-25"></a>lat=soil1<span class="op">$</span>Latitude</span>
<span id="cb16-26"><a href="country-driven-global-mapping-approach.html#cb16-26"></a>id=soil1<span class="op">$</span>Pits</span>
<span id="cb16-27"><a href="country-driven-global-mapping-approach.html#cb16-27"></a>top=soil1<span class="op">$</span>Upper</span>
<span id="cb16-28"><a href="country-driven-global-mapping-approach.html#cb16-28"></a>bottom=soil1<span class="op">$</span>Lower</span>
<span id="cb16-29"><a href="country-driven-global-mapping-approach.html#cb16-29"></a>horizon=soil1<span class="op">$</span>Horizon</span>
<span id="cb16-30"><a href="country-driven-global-mapping-approach.html#cb16-30"></a>ECdp=soil1<span class="op">$</span>EC</span>
<span id="cb16-31"><a href="country-driven-global-mapping-approach.html#cb16-31"></a>prof1=<span class="kw">join</span>(<span class="kw">data.frame</span>(id,top,bottom, ECdp, horizon),<span class="kw">data.frame</span>(id,lon,lat),<span class="dt">type=</span><span class="st">&quot;inn er&quot;</span>)</span>
<span id="cb16-32"><a href="country-driven-global-mapping-approach.html#cb16-32"></a></span>
<span id="cb16-33"><a href="country-driven-global-mapping-approach.html#cb16-33"></a></span>
<span id="cb16-34"><a href="country-driven-global-mapping-approach.html#cb16-34"></a><span class="kw">depths</span>(prof1)=id<span class="op">~</span>top<span class="op">+</span>bottom Warning message<span class="op">:</span></span>
<span id="cb16-35"><a href="country-driven-global-mapping-approach.html#cb16-35"></a>converting IDs from factor to character</span>
<span id="cb16-36"><a href="country-driven-global-mapping-approach.html#cb16-36"></a><span class="kw">site</span>(prof1)=<span class="er">~</span>lon<span class="op">+</span>lat</span>
<span id="cb16-37"><a href="country-driven-global-mapping-approach.html#cb16-37"></a><span class="kw">coordinates</span>(prof1) =<span class="st"> </span><span class="er">~</span>lon<span class="op">+</span>lat</span>
<span id="cb16-38"><a href="country-driven-global-mapping-approach.html#cb16-38"></a><span class="kw">proj4string</span>(prof1)=<span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span>)</span>
<span id="cb16-39"><a href="country-driven-global-mapping-approach.html#cb16-39"></a>depth.s =<span class="st"> </span><span class="kw">mpspline</span>(prof1, <span class="dt">var.name=</span> <span class="st">&quot;ECdp&quot;</span>, <span class="dt">lam=</span><span class="fl">0.8</span>,<span class="dt">d =</span> <span class="kw">t</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">100</span>,<span class="dv">150</span>)))</span>
<span id="cb16-40"><a href="country-driven-global-mapping-approach.html#cb16-40"></a></span>
<span id="cb16-41"><a href="country-driven-global-mapping-approach.html#cb16-41"></a><span class="kw">plot</span>(prof1, <span class="dt">color=</span> <span class="st">&quot;ECdp&quot;</span>, <span class="dt">name=</span><span class="st">&quot;horizon&quot;</span>,<span class="dt">color.palette =</span> <span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&#39;Accent&#39;</span></span>
<span id="cb16-42"><a href="country-driven-global-mapping-approach.html#cb16-42"></a>)),<span class="dt">par=</span><span class="kw">c</span>(<span class="dt">cex.lab=</span><span class="fl">2.0</span>)) <span class="co">#Figure 5.5</span></span>
<span id="cb16-43"><a href="country-driven-global-mapping-approach.html#cb16-43"></a></span>
<span id="cb16-44"><a href="country-driven-global-mapping-approach.html#cb16-44"></a></span>
<span id="cb16-45"><a href="country-driven-global-mapping-approach.html#cb16-45"></a>lon=soil1<span class="op">$</span>Longitude</span>
<span id="cb16-46"><a href="country-driven-global-mapping-approach.html#cb16-46"></a>lat=soil1<span class="op">$</span>Latitude</span>
<span id="cb16-47"><a href="country-driven-global-mapping-approach.html#cb16-47"></a>id=soil1<span class="op">$</span>Pits</span>
<span id="cb16-48"><a href="country-driven-global-mapping-approach.html#cb16-48"></a>top=soil1<span class="op">$</span>Upper</span>
<span id="cb16-49"><a href="country-driven-global-mapping-approach.html#cb16-49"></a>bottom=soil1<span class="op">$</span>Lower</span>
<span id="cb16-50"><a href="country-driven-global-mapping-approach.html#cb16-50"></a>horizon=soil1<span class="op">$</span>Horizon</span>
<span id="cb16-51"><a href="country-driven-global-mapping-approach.html#cb16-51"></a>ECdp=soil1<span class="op">$</span>EC</span>
<span id="cb16-52"><a href="country-driven-global-mapping-approach.html#cb16-52"></a>prof1=<span class="kw">join</span>(<span class="kw">data.frame</span>(id,top,bottom, ECdp, horizon),<span class="kw">data.frame</span>(id,lon,lat),<span class="dt">type=</span><span class="st">&quot;inn er&quot;</span>)</span>
<span id="cb16-53"><a href="country-driven-global-mapping-approach.html#cb16-53"></a></span>
<span id="cb16-54"><a href="country-driven-global-mapping-approach.html#cb16-54"></a></span>
<span id="cb16-55"><a href="country-driven-global-mapping-approach.html#cb16-55"></a><span class="kw">depths</span>(prof1)=id<span class="op">~</span>top<span class="op">+</span>bottom Warning message<span class="op">:</span></span>
<span id="cb16-56"><a href="country-driven-global-mapping-approach.html#cb16-56"></a>converting IDs from factor to character</span>
<span id="cb16-57"><a href="country-driven-global-mapping-approach.html#cb16-57"></a><span class="kw">site</span>(prof1)=<span class="er">~</span>lon<span class="op">+</span>lat</span>
<span id="cb16-58"><a href="country-driven-global-mapping-approach.html#cb16-58"></a><span class="kw">coordinates</span>(prof1) =<span class="st"> </span><span class="er">~</span>lon<span class="op">+</span>lat</span>
<span id="cb16-59"><a href="country-driven-global-mapping-approach.html#cb16-59"></a><span class="kw">proj4string</span>(prof1)=<span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span>)</span>
<span id="cb16-60"><a href="country-driven-global-mapping-approach.html#cb16-60"></a>depth.s =<span class="st"> </span><span class="kw">mpspline</span>(prof1, <span class="dt">var.name=</span> <span class="st">&quot;ECdp&quot;</span>, <span class="dt">lam=</span><span class="fl">0.8</span>,<span class="dt">d =</span> <span class="kw">t</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">100</span>,<span class="dv">150</span>))) </span>
<span id="cb16-61"><a href="country-driven-global-mapping-approach.html#cb16-61"></a></span>
<span id="cb16-62"><a href="country-driven-global-mapping-approach.html#cb16-62"></a><span class="kw">plot</span>(prof1, <span class="dt">color=</span> <span class="st">&quot;ECdp&quot;</span>, <span class="dt">name=</span><span class="st">&quot;horizon&quot;</span>,<span class="dt">color.palette =</span> <span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&#39;Accent&#39;</span></span>
<span id="cb16-63"><a href="country-driven-global-mapping-approach.html#cb16-63"></a>)),<span class="dt">par=</span><span class="kw">c</span>(<span class="dt">cex.lab=</span><span class="fl">2.0</span>)) <span class="co">#Figure 5.5</span></span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.5.PNG" alt="" />
<p class="caption">Figure 5.5: Example depth harmonization for ECse</p>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="country-driven-global-mapping-approach.html#cb17-1"></a><span class="co">#Step 1-8: Extract the depth-harmonized soil data and re-project</span></span>
<span id="cb17-2"><a href="country-driven-global-mapping-approach.html#cb17-2"></a>soilhrmdepths=<span class="kw">data.frame</span>(depth.s<span class="op">$</span>idcol, depth.s<span class="op">$</span>var.std, <span class="dt">check.names =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-3"><a href="country-driven-global-mapping-approach.html#cb17-3"></a>soil2=<span class="kw">merge</span>(soil1,soilhrmdepths,<span class="dt">by=</span><span class="kw">intersect</span>(<span class="kw">names</span>(soil1),<span class="kw">names</span>(soilhrmdepths)),by.x</span>
<span id="cb17-4"><a href="country-driven-global-mapping-approach.html#cb17-4"></a>=<span class="st">&quot;Pits&quot;</span>,<span class="dt">by.y=</span><span class="st">&quot;depth.s.idcol&quot;</span>,<span class="dt">all=</span><span class="ot">TRUE</span>)</span>
<span id="cb17-5"><a href="country-driven-global-mapping-approach.html#cb17-5"></a><span class="kw">coordinates</span>(soil2)=<span class="er">~</span>Longitude<span class="op">+</span>Latitude</span>
<span id="cb17-6"><a href="country-driven-global-mapping-approach.html#cb17-6"></a><span class="kw">proj4string</span>(soil2)=<span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)<span class="co">#Attach CRS to the data</span></span>
<span id="cb17-7"><a href="country-driven-global-mapping-approach.html#cb17-7"></a><span class="co">#Harmonize CRS and ensure use of the correct +proj and +zone for the study area</span></span>
<span id="cb17-8"><a href="country-driven-global-mapping-approach.html#cb17-8"></a>soil1=<span class="kw">spTransform</span>(soil2,<span class="kw">CRS</span>(<span class="st">&quot;+proj=utm +zone=36 +ellps=WGS84 +units=m +no_defs&quot;</span>))</span>
<span id="cb17-9"><a href="country-driven-global-mapping-approach.html#cb17-9"></a>soil1=soil2</span>
<span id="cb17-10"><a href="country-driven-global-mapping-approach.html#cb17-10"></a><span class="kw">hist</span>(soil1<span class="op">$</span>EC)</span>
<span id="cb17-11"><a href="country-driven-global-mapping-approach.html#cb17-11"></a>soil1=<span class="kw">subset</span>(soil1,<span class="op">!</span><span class="kw">is.na</span>(soil1<span class="op">$</span>EC))</span>
<span id="cb17-12"><a href="country-driven-global-mapping-approach.html#cb17-12"></a><span class="kw">bubble</span>(soil1,<span class="st">&quot;X0.30.cm&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Harmonized EC (0-30 cm)&quot;</span>) <span class="co">#Figure 5.6</span></span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.6.PNG" alt="" />
<p class="caption">Figure 5.6: Bubble plot for top 0-30cm harmonized EC</p>
</div>
<p>This harmonization is done to transform the frequency distribution to normal distribution. Frequency transformation to normal distribution is optional for spatial modelling algorithms. If it’s chosen, then the empirical distribution is first established through histogram analysis and transformation implemented if the distribution is found to be skewed. hist function is used to extract and plot the histogram. Box-Cox (1964) transformation is preferred. The following scripts illustrate the steps for transforming statistical distribution. Summary distribution is first obtained to establish if there are zeros, NAs, or negative values. It is desirable to remove them before implementing Box-Cox transformation.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="country-driven-global-mapping-approach.html#cb18-1"></a><span class="co">#Step 1-9: Harmonization of statistical distribution</span></span>
<span id="cb18-2"><a href="country-driven-global-mapping-approach.html#cb18-2"></a></span>
<span id="cb18-3"><a href="country-driven-global-mapping-approach.html#cb18-3"></a><span class="kw">summary</span>(soil1<span class="op">$</span>X0.<span class="fl">30.</span>cm)</span>
<span id="cb18-4"><a href="country-driven-global-mapping-approach.html#cb18-4"></a>Min.	1st Qu.	Median		Mean	3rd Qu.	Max. <span class="fl">0.0000</span>		<span class="fl">0.6291</span>	<span class="fl">1.8709</span>	<span class="fl">6.6812</span>		<span class="fl">5.3121</span> <span class="fl">154.2463</span></span>
<span id="cb18-5"><a href="country-driven-global-mapping-approach.html#cb18-5"></a></span>
<span id="cb18-6"><a href="country-driven-global-mapping-approach.html#cb18-6"></a>soil1<span class="op">$</span>dummy=(soil1<span class="op">$</span>EC)<span class="op">+</span><span class="fl">0.001</span> <span class="co"># add &quot;+0.001&quot; if minimum X0.30.cm is zero</span></span>
<span id="cb18-7"><a href="country-driven-global-mapping-approach.html#cb18-7"></a><span class="kw">hist</span>(soil1<span class="op">$</span>dummy, <span class="dt">main=</span><span class="st">&quot;Frequency distribution (before transformation)&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Harmo nized EC (dS/m)&quot;</span>)</span>
<span id="cb18-8"><a href="country-driven-global-mapping-approach.html#cb18-8"></a>soil1<span class="op">$</span>Tran=(soil1<span class="op">$</span>dummy<span class="op">^</span>(<span class="kw">as.numeric</span>(car<span class="op">::</span><span class="kw">powerTransform</span>(soil1<span class="op">$</span>dummy, <span class="dt">family =</span><span class="st">&quot;bcPowe r&quot;</span>)[<span class="st">&quot;lambda&quot;</span>]))<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span>(<span class="kw">as.numeric</span>(car<span class="op">::</span><span class="kw">powerTransform</span>(soil1<span class="op">$</span>dummy, <span class="dt">family =</span><span class="st">&quot;bcPower&quot;</span>)[<span class="st">&quot;la mbda&quot;</span>]))</span>
<span id="cb18-9"><a href="country-driven-global-mapping-approach.html#cb18-9"></a><span class="kw">hist</span>(soil1<span class="op">$</span>Tran, <span class="dt">main=</span><span class="st">&quot;Frequency distribution (after transformation)&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;Harmoniz ed EC (dS/m)&quot;</span>)</span></code></pre></div>
<p>Histogram plot of the empirical distributions before and after transformation are given in Figure 5.7.</p>
<div class="figure">
<img src="figures/images/Figure5.7.PNG" alt="" />
<p class="caption">Figure 5.7: Frequency distribution before and after EC transformation</p>
</div>
</div>
</div>
<div id="step-2-spatial-modelling-of-indicators" class="section level2">
<h2><span class="header-section-number">5.3</span> Step 2: Spatial modelling of indicators</h2>
<p>Spatial modelling of indicators of salt-affected soils is based on the digital soil mapping (DSM) concept. In this concept, a relationship is built between the soil indicators of salt problems and spatial predictors (GIS layers of drivers and indicators of salt problems and soil forming factors). This approach enables quantification of:</p>
<ol style="list-style-type: decimal">
<li>Spatial information of indicators of salt-affected soils (EC, pH, ESP) and different soil depths;</li>
<li>Mapping uncertainties and accuracy;</li>
<li>Spatial information of classes and intensity of salt problems.</li>
</ol>
<div id="choosing-suitable-model" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Choosing suitable model</h3>
<p>DSM approach proposes a mathematical relationship between the target soil variable and its predictors (or representation of soil forming factors). This relationship is popularly known as the SCORPAN model (McBratney et al., 2003):</p>
<p><span class="math display">\[\begin{equation}
\tag{5.1}
Target\ soil\ variable = f(S,C,O,R,P,A,N) + error
\end{equation}\]</span></p>
<p>where S isthe soil component (such as soil map), C is climate, O is organism, R isrelief, P is parent material,
A is the Age(time), N is the spatial coordinates, error is the error term, and f is the link function of the
relationship between the predictors and the target soil variable. Popular models often used to represent f
are linear, random-forest, support-vector machine, mixed-effects, regression kriging, etc. The
soilassessment package provides regmodelSuit function for guiding the choice of the appropriate model
for mapping soil variables. It tests different models and returns the top nine models using RMSE, ME, NSE
and r<sup>2</sup>. Lowest root mean-square error (RMSE), highest r<sup>2</sup>, lowest mean error (ME), highest Nash-Sutcliff
coefficient of efficiency (NSE) are then used as the guiding criteria for choosing the suitable model (Holst
and Thyregod, 1999; Gupta and Kling, 2011).</p>
<p><span class="math display">\[\begin{equation}
\tag{5.2}
RMSD =  \sqrt{\sum_{i=1}^N \frac{(x_i -\bar{x_i})^2}N}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{5.3}
ME = \frac{y_0 - y_m}n
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{5.4}
NSE = 1 - \frac{(y_0-y_m)^2}{(y_0 -\bar{y})^2}
\end{equation}\]</span></p>
<p>where harmonized value is <span class="math inline">\(y_o\)</span>, <span class="math inline">\(y_m\)</span> is the modelled value, and the mean value is <span class="math inline">\(\bar{y}\)</span>.
An initial step for spatial modelling is to build the model in a calibration dataset and then testing the model using an independent dataset. This calls for the establishment of calibration and validation datasets. These datasets should have well aligned soil properties (indicators) and spatial predictors at each georeferenced sampling point. Pixel value extraction of GIS layers (predictors) using point data (soil1) is a suitable method for developing either the calibration or validation datasets.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="country-driven-global-mapping-approach.html#cb19-1"></a><span class="co">#Step 2-1: Extract pixel values of predictors and attach to the soil sampling points</span></span>
<span id="cb19-2"><a href="country-driven-global-mapping-approach.html#cb19-2"></a><span class="co"># First check for similarity in coordinate reference system - crs and then extract the predictors</span></span>
<span id="cb19-3"><a href="country-driven-global-mapping-approach.html#cb19-3"></a><span class="kw">crs</span>(predictors); <span class="kw">crs</span>(soil1) </span>
<span id="cb19-4"><a href="country-driven-global-mapping-approach.html#cb19-4"></a><span class="co">#+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 CRS arguments:</span></span>
<span id="cb19-5"><a href="country-driven-global-mapping-approach.html#cb19-5"></a><span class="co">#+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0</span></span></code></pre></div>
<p>It’s important to ensure that the CRS for predictors and soil database are the same before starting pixel extraction</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="country-driven-global-mapping-approach.html#cb20-1"></a><span class="co">#Then extract the pixel values for all predictors into the soildata dataframe</span></span>
<span id="cb20-2"><a href="country-driven-global-mapping-approach.html#cb20-2"></a>{predictors.ov=<span class="kw">over</span>(soil1, predictors)</span>
<span id="cb20-3"><a href="country-driven-global-mapping-approach.html#cb20-3"></a>	soil1<span class="op">$</span>dem=predictors.ov<span class="op">$</span>dem</span>
<span id="cb20-4"><a href="country-driven-global-mapping-approach.html#cb20-4"></a>soil1<span class="op">$</span>slope=predictors.ov<span class="op">$</span>slope</span>
<span id="cb20-5"><a href="country-driven-global-mapping-approach.html#cb20-5"></a>	soil1<span class="op">$</span>cnbl=predictors.ov<span class="op">$</span>cnbl</span>
<span id="cb20-6"><a href="country-driven-global-mapping-approach.html#cb20-6"></a>	soil1<span class="op">$</span>ls=predictors.ov<span class="op">$</span>ls</span>
<span id="cb20-7"><a href="country-driven-global-mapping-approach.html#cb20-7"></a>	soil1<span class="op">$</span>valley=predictors.ov<span class="op">$</span>valley</span>
<span id="cb20-8"><a href="country-driven-global-mapping-approach.html#cb20-8"></a>soil1<span class="op">$</span>loncurve=predictors.ov<span class="op">$</span>loncurve</span>
<span id="cb20-9"><a href="country-driven-global-mapping-approach.html#cb20-9"></a>soil1<span class="op">$</span>lcover=predictors.ov<span class="op">$</span>lcover</span>
<span id="cb20-10"><a href="country-driven-global-mapping-approach.html#cb20-10"></a>soil1<span class="op">$</span>rain=predictors.ov<span class="op">$</span>rain</span>
<span id="cb20-11"><a href="country-driven-global-mapping-approach.html#cb20-11"></a>soil1<span class="op">$</span>pgeology=predictors.ov<span class="op">$</span>pgeology</span>
<span id="cb20-12"><a href="country-driven-global-mapping-approach.html#cb20-12"></a>soil1<span class="op">$</span>geology=predictors.ov<span class="op">$</span>geology</span>
<span id="cb20-13"><a href="country-driven-global-mapping-approach.html#cb20-13"></a>soil1<span class="op">$</span>PCA1=predictors.ov<span class="op">$</span>PCA1</span>
<span id="cb20-14"><a href="country-driven-global-mapping-approach.html#cb20-14"></a>soil1<span class="op">$</span>PCA2=predictors.ov<span class="op">$</span>PCA2</span>
<span id="cb20-15"><a href="country-driven-global-mapping-approach.html#cb20-15"></a>soil1<span class="op">$</span>PCA3=predictors.ov<span class="op">$</span>PCA3</span>
<span id="cb20-16"><a href="country-driven-global-mapping-approach.html#cb20-16"></a>soil1<span class="op">$</span>PCA4=predictors.ov<span class="op">$</span>PCA4</span>
<span id="cb20-17"><a href="country-driven-global-mapping-approach.html#cb20-17"></a>}</span>
<span id="cb20-18"><a href="country-driven-global-mapping-approach.html#cb20-18"></a></span>
<span id="cb20-19"><a href="country-driven-global-mapping-approach.html#cb20-19"></a><span class="co">#Step 2-2: Establish suitable DSM model</span></span>
<span id="cb20-20"><a href="country-driven-global-mapping-approach.html#cb20-20"></a><span class="kw">summary</span>(soil1)</span>
<span id="cb20-21"><a href="country-driven-global-mapping-approach.html#cb20-21"></a><span class="co"># Object of class SpatialPointsDataFrame Coordinates:</span></span>
<span id="cb20-22"><a href="country-driven-global-mapping-approach.html#cb20-22"></a><span class="co"># min		max Longitude -261790.8	497928</span></span>
<span id="cb20-23"><a href="country-driven-global-mapping-approach.html#cb20-23"></a><span class="co"># Latitude	1841020.7 2430061</span></span>
<span id="cb20-24"><a href="country-driven-global-mapping-approach.html#cb20-24"></a><span class="co"># Is projected: TRUE proj4string :</span></span>
<span id="cb20-25"><a href="country-driven-global-mapping-approach.html#cb20-25"></a><span class="co"># [+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs +ellps=WGS84</span></span>
<span id="cb20-26"><a href="country-driven-global-mapping-approach.html#cb20-26"></a><span class="co"># +towgs84=0,0,0]</span></span>
<span id="cb20-27"><a href="country-driven-global-mapping-approach.html#cb20-27"></a><span class="co"># Number of points: 1498 Data attributes:</span></span>
<span id="cb20-28"><a href="country-driven-global-mapping-approach.html#cb20-28"></a><span class="co"># Pits		Sample	Upper	Lower	Horizon</span></span>
<span id="cb20-29"><a href="country-driven-global-mapping-approach.html#cb20-29"></a><span class="co"># 292	:	8	1	:	1	Min.	:	0.00	Min.	:	2.00	Min.	:1.000</span></span>
<span id="cb20-30"><a href="country-driven-global-mapping-approach.html#cb20-30"></a><span class="co"># 280	:	7	10	:	1	1st Qu.:	0.00	1st Qu.: 30.00	1st Qu.:1.000</span></span>
<span id="cb20-31"><a href="country-driven-global-mapping-approach.html#cb20-31"></a><span class="co"># 293	:	7	100	:	1	Median : 30.00	Median : 64.00	Median :2.500</span></span>
<span id="cb20-32"><a href="country-driven-global-mapping-approach.html#cb20-32"></a><span class="co"># 327	:	7	1000	:	1	Mean	: 42.56	Mean	: 75.37	Mean	:2.692</span></span>
<span id="cb20-33"><a href="country-driven-global-mapping-approach.html#cb20-33"></a><span class="co"># 372	:	7	1001	:	1	3rd Qu.: 70.00	3rd Qu.:110.00	3rd Qu.:4.000</span></span>
<span id="cb20-34"><a href="country-driven-global-mapping-approach.html#cb20-34"></a><span class="co"># 378	:	7	1002	:	1	Max.	:210.00	Max.	:300.00	Max.	:8.000</span></span>
<span id="cb20-35"><a href="country-driven-global-mapping-approach.html#cb20-35"></a><span class="co"># ....</span></span>
<span id="cb20-36"><a href="country-driven-global-mapping-approach.html#cb20-36"></a><span class="co"># ls	valley	loncurve	lcover</span></span>
<span id="cb20-37"><a href="country-driven-global-mapping-approach.html#cb20-37"></a><span class="co"># Min.	:0.00051	Min.	:	0.7306	Min.	:0e+00	Min.	:	2.0</span></span>
<span id="cb20-38"><a href="country-driven-global-mapping-approach.html#cb20-38"></a><span class="co"># 1st Qu.:0.00129	1st Qu.: 30.1037	1st Qu.:0e+00	1st Qu.:178.0</span></span>
<span id="cb20-39"><a href="country-driven-global-mapping-approach.html#cb20-39"></a><span class="co"># Median :0.00219	Median : 43.0999	Median :0e+00	Median :178.0</span></span>
<span id="cb20-40"><a href="country-driven-global-mapping-approach.html#cb20-40"></a><span class="co"># Mean	:0.02028	Mean	: 44.6613	Mean	:0e+00	Mean	:155.5</span></span>
<span id="cb20-41"><a href="country-driven-global-mapping-approach.html#cb20-41"></a><span class="co"># 3rd Qu.:0.02821	3rd Qu.: 62.2221	3rd Qu.:0e+00	3rd Qu.:178.0</span></span>
<span id="cb20-42"><a href="country-driven-global-mapping-approach.html#cb20-42"></a><span class="co"># Max.	:0.44952	Max.	:105.7522	Max.	:1e-05	Max.	:188.0</span></span>
<span id="cb20-43"><a href="country-driven-global-mapping-approach.html#cb20-43"></a><span class="co"># NA&#39;s	4	NA&#39;s	4	NA&#39;s	4	NA&#39;s	4</span></span></code></pre></div>
<p>The NAs appearing in the data need to be removed (or investigated).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="country-driven-global-mapping-approach.html#cb21-1"></a>soil1=<span class="kw">subset</span>(soil1,<span class="op">!</span><span class="kw">is.na</span>(soil1<span class="op">$</span>dem))</span>
<span id="cb21-2"><a href="country-driven-global-mapping-approach.html#cb21-2"></a>soil11a=soil1<span class="op">@</span>data[,<span class="kw">c</span>(<span class="st">&quot;Tran&quot;</span>,<span class="st">&quot;dem&quot;</span>,<span class="st">&quot;slope&quot;</span>,<span class="st">&quot;ls&quot;</span>,<span class="st">&quot;cnbl&quot;</span>,<span class="st">&quot;loncurve&quot;</span>,<span class="st">&quot;valley&quot;</span>,<span class="st">&quot;rain&quot;</span>,<span class="st">&quot;l</span></span>
<span id="cb21-3"><a href="country-driven-global-mapping-approach.html#cb21-3"></a><span class="st">cover&quot;</span>,<span class="st">&quot;pgeology&quot;</span>,<span class="st">&quot;geology&quot;</span>,<span class="st">&quot;PCA1&quot;</span>,<span class="st">&quot;PCA2&quot;</span>,<span class="st">&quot;PCA3&quot;</span>,<span class="st">&quot;PCA4&quot;</span>)]</span>
<span id="cb21-4"><a href="country-driven-global-mapping-approach.html#cb21-4"></a><span class="kw">regmodelSuit</span>(soil11a,Tran,dem,geology,pgeology,slope,rain,loncurve,cnbl,valley,lcove r,ls,PCA1,PCA2,PCA3, PCA4)</span>
<span id="cb21-5"><a href="country-driven-global-mapping-approach.html#cb21-5"></a><span class="co"># |========================================================================| 100%</span></span>
<span id="cb21-6"><a href="country-driven-global-mapping-approach.html#cb21-6"></a><span class="co"># 	ME	RMSE	R2	NSE</span></span>
<span id="cb21-7"><a href="country-driven-global-mapping-approach.html#cb21-7"></a><span class="co"># Linear	1.37034834	1.8129133	0.1320264	-4.45424486</span></span>
<span id="cb21-8"><a href="country-driven-global-mapping-approach.html#cb21-8"></a><span class="co"># RandomForest	0.24614749	0.4291176	0.9623631	0.99707891</span></span>
<span id="cb21-9"><a href="country-driven-global-mapping-approach.html#cb21-9"></a><span class="co"># SVM	1.34745209	1.8212570	0.1357457	-4.44014767</span></span>
<span id="cb21-10"><a href="country-driven-global-mapping-approach.html#cb21-10"></a><span class="co"># BayesianGLM	1.36669809	1.8051662	0.1399516	-4.55079779</span></span>
<span id="cb21-11"><a href="country-driven-global-mapping-approach.html#cb21-11"></a><span class="co"># BaggedCART	0.88676091	1.1705841	0.7018074	0.44302759</span></span>
<span id="cb21-12"><a href="country-driven-global-mapping-approach.html#cb21-12"></a><span class="co"># Cubist	0.07851255	0.2744213	0.9753726	1.00000000</span></span>
<span id="cb21-13"><a href="country-driven-global-mapping-approach.html#cb21-13"></a><span class="co"># CART	1.40147986	1.8274332	0.1320797	-4.56273851</span></span>
<span id="cb21-14"><a href="country-driven-global-mapping-approach.html#cb21-14"></a><span class="co"># Ranger	0.26852953	0.4205875	0.9655103	0.99702690</span></span>
<span id="cb21-15"><a href="country-driven-global-mapping-approach.html#cb21-15"></a><span class="co"># QuantRandForest	0.04923343	0.2855093	0.9761419	1.00000000</span></span>
<span id="cb21-16"><a href="country-driven-global-mapping-approach.html#cb21-16"></a><span class="co"># QuantNeuralNT	1.16162791	1.7075411	0.2582558	0.07778314</span></span></code></pre></div>
<p>The above results depict quantum regression random forest and cubist models as suitable for modelling the 0-30cm ECse using the given spatial predictors in the case-study test data.</p>
</div>
<div id="model-building-and-testing" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Model building and testing</h3>
<p>Statistical model building and testing strategies recommend independent datasets for model building and for model testing. These datasets should ideally be sampled with focus for model building and testing. In the absence of independently sampled dataset for either model building (calibration) or testing (validation), data-splitting strategy is often used. Data-splitting strategy randomly (or stratified randomly) splits the data into two parts. One part is held as calibration and the other as validation. The validation dataset is used for accuracy assessment. The indices for reporting modelling accuracy include RMSE, ME, r2, NSE, and a graphical plot of the modelled versus harmonized values. Data-splitting may be arbitrarily chosen according to or depending on the data-size.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="country-driven-global-mapping-approach.html#cb22-1"></a><span class="co">#Step 2-3: Model building and testing</span></span>
<span id="cb22-2"><a href="country-driven-global-mapping-approach.html#cb22-2"></a>{soil4=<span class="kw">as.data.frame</span>(soil1)</span>
<span id="cb22-3"><a href="country-driven-global-mapping-approach.html#cb22-3"></a>bound &lt;-<span class="st"> </span><span class="kw">floor</span>((<span class="kw">nrow</span>(soil4)<span class="op">/</span><span class="dv">4</span>)<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb22-4"><a href="country-driven-global-mapping-approach.html#cb22-4"></a>soil3 &lt;-<span class="st"> </span>soil4[<span class="kw">sample</span>(<span class="kw">nrow</span>(soil4)), ]</span>
<span id="cb22-5"><a href="country-driven-global-mapping-approach.html#cb22-5"></a>df.traina &lt;-<span class="st"> </span>soil3[<span class="dv">1</span><span class="op">:</span>bound, ]</span>
<span id="cb22-6"><a href="country-driven-global-mapping-approach.html#cb22-6"></a>df.testa &lt;-<span class="st"> </span>soil3[(bound<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(soil3), ]}</span>
<span id="cb22-7"><a href="country-driven-global-mapping-approach.html#cb22-7"></a></span>
<span id="cb22-8"><a href="country-driven-global-mapping-approach.html#cb22-8"></a>rf.ec=<span class="kw">train</span>(Tran<span class="op">~</span>(slope<span class="op">+</span>rain<span class="op">+</span>loncurve<span class="op">+</span>ls<span class="op">+</span>cnbl<span class="op">+</span>valley<span class="op">+</span>lcover<span class="op">+</span>dem<span class="op">+</span>PCA1<span class="op">+</span>PCA2<span class="op">+</span>PCA3<span class="op">+</span>PCA4<span class="op">+</span><span class="st"> </span>PCA5), <span class="dt">data =</span> df.traina, <span class="dt">method =</span> <span class="st">&quot;qrf&quot;</span>, <span class="dt">trControl=</span><span class="kw">trainControl</span>( <span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>,numbe <span class="dt">r=</span><span class="dv">5</span>,<span class="dt">returnResamp =</span> <span class="st">&quot;all&quot;</span>,<span class="dt">savePredictions =</span> <span class="ot">TRUE</span>, <span class="dt">search =</span> <span class="st">&quot;random&quot;</span>,<span class="dt">verboseIter =</span> <span class="ot">FALSE</span></span>
<span id="cb22-9"><a href="country-driven-global-mapping-approach.html#cb22-9"></a>))</span>
<span id="cb22-10"><a href="country-driven-global-mapping-approach.html#cb22-10"></a></span>
<span id="cb22-11"><a href="country-driven-global-mapping-approach.html#cb22-11"></a><span class="co"># Show the prediction interval</span></span>
<span id="cb22-12"><a href="country-driven-global-mapping-approach.html#cb22-12"></a>df.testa<span class="op">$</span>Strain=<span class="kw">predict</span>(rf.ec,<span class="dt">newdata=</span>df.testa)</span>
<span id="cb22-13"><a href="country-driven-global-mapping-approach.html#cb22-13"></a><span class="kw">hist</span>(df.testa<span class="op">$</span>Strain,<span class="dt">xlab=</span><span class="st">&quot;Box-Cox Transformed ECse (0-30cm)&quot;</span>, <span class="dt">main=</span><span class="ot">NULL</span>)</span>
<span id="cb22-14"><a href="country-driven-global-mapping-approach.html#cb22-14"></a><span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">quantile</span>(df.testa<span class="op">$</span>Strain, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>)),<span class="dt">lty =</span> <span class="dv">5</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.8.PNG" alt="" />
<p class="caption">Figure 5.8: Graphical plot of frequency distribution with prediction limits at 95% confidence interval</p>
</div>
<p>Prediction limits on the Box-Cox transformed values at 95% confidence interval are given in Figure 5.8. It shows the interval around the mean of 0.77 as [-2, 4.1].</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="country-driven-global-mapping-approach.html#cb23-1"></a><span class="co">#Step 2-4: Accuracy assessment</span></span>
<span id="cb23-2"><a href="country-driven-global-mapping-approach.html#cb23-2"></a><span class="kw">cor</span>(df.testa<span class="op">$</span>Strain,df.testa<span class="op">$</span>dummy)<span class="op">^</span><span class="dv">2</span> [<span class="dv">1</span>] <span class="fl">0.9950319</span></span>
<span id="cb23-3"><a href="country-driven-global-mapping-approach.html#cb23-3"></a>{<span class="kw">plot</span>(df.testa<span class="op">$</span>Strain<span class="op">~</span>df.testa<span class="op">$</span>dummy, <span class="dt">xlab=</span><span class="st">&quot;Measured ECse&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Modelled ECse&quot;</span>, mai <span class="dt">n=</span><span class="st">&quot;Accuracy assessment on hold-out samples&quot;</span>)</span>
<span id="cb23-4"><a href="country-driven-global-mapping-approach.html#cb23-4"></a><span class="op">+</span>	<span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>,<span class="dt">lty=</span><span class="dv">20</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)} <span class="co"># Figure 5.9</span></span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.9.PNG" alt="" />
<p class="caption">Figure 5.9: Graphical plot of predicted versus measured EC</p>
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="country-driven-global-mapping-approach.html#cb24-1"></a>Bias=<span class="kw">mean</span>(df.testa<span class="op">$</span>Strain<span class="op">-</span>df.testa<span class="op">$</span>dummy,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb24-2"><a href="country-driven-global-mapping-approach.html#cb24-2"></a>RMSE=<span class="kw">sqrt</span>(<span class="kw">sum</span>(df.testa<span class="op">$</span>Strain<span class="op">-</span>df.testa<span class="op">$</span>dummy,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="kw">length</span>((df.testa<span class="op">$</span>Strain<span class="op">-</span>d f.testa<span class="op">$</span>dummy)))</span>
<span id="cb24-3"><a href="country-driven-global-mapping-approach.html#cb24-3"></a>Rsquared=<span class="kw">cor</span>(df.testa<span class="op">$</span>Strain,df.testa<span class="op">$</span>dummy)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb24-4"><a href="country-driven-global-mapping-approach.html#cb24-4"></a>NSE=<span class="dv">1</span><span class="op">-</span><span class="kw">sum</span>(df.testa<span class="op">$</span>Strain<span class="op">-</span>df.testa<span class="op">$</span>dummy,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="kw">sum</span>((df.testa<span class="op">$</span>Strain<span class="op">-</span><span class="kw">mean</span>(df. testa<span class="op">$</span>dummy,<span class="dt">na.rm=</span><span class="ot">TRUE</span>))<span class="op">^</span><span class="dv">2</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb24-5"><a href="country-driven-global-mapping-approach.html#cb24-5"></a>statia=<span class="kw">data.frame</span>(Bias,RMSE,Rsquared,NSE);<span class="kw">View</span>(statia)</span>
<span id="cb24-6"><a href="country-driven-global-mapping-approach.html#cb24-6"></a><span class="kw">write.csv</span>(statia,<span class="dt">file =</span> <span class="st">&quot;EC0_30_validmodel_stats.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="spatial-prediction-and-uncertainty-assessment" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Spatial prediction and uncertainty assessment</h3>
<p>The model can now be used to produce spatial prediction of the target variable (EC in this case) in the whole study area. A summary of the predicted and validation data can also be compared to give indication of the prediction ranges.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="country-driven-global-mapping-approach.html#cb25-1"></a><span class="co">#Step 2-3: Use the developed model to predict the map of EC</span></span>
<span id="cb25-2"><a href="country-driven-global-mapping-approach.html#cb25-2"></a>lmbda1=(<span class="kw">as.numeric</span>(<span class="kw">powerTransform</span>(soil1<span class="op">$</span>dummy, <span class="dt">family =</span><span class="st">&quot;bcPower&quot;</span>)[<span class="st">&quot;lambda&quot;</span>]))</span>
<span id="cb25-3"><a href="country-driven-global-mapping-approach.html#cb25-3"></a>predictors<span class="op">$</span>ECte=<span class="kw">predicta</span>(rf.ec,predictors)</span>
<span id="cb25-4"><a href="country-driven-global-mapping-approach.html#cb25-4"></a><span class="kw">coordinates</span>(df.testa)=<span class="er">~</span>Longitude<span class="op">+</span>Latitude</span>
<span id="cb25-5"><a href="country-driven-global-mapping-approach.html#cb25-5"></a><span class="kw">proj4string</span>(df.testa)=<span class="kw">CRS</span>(<span class="st">&quot;+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs +ellps= WGS84 +towgs84=0,0,0&quot;</span>) <span class="co"># Make sure to use correct CRS</span></span>
<span id="cb25-6"><a href="country-driven-global-mapping-approach.html#cb25-6"></a>predicters.ov1=<span class="kw">over</span>(df.testa, predictors)</span>
<span id="cb25-7"><a href="country-driven-global-mapping-approach.html#cb25-7"></a>df.testa<span class="op">$</span>Predre=predicters.ov1<span class="op">$</span>ECse</span>
<span id="cb25-8"><a href="country-driven-global-mapping-approach.html#cb25-8"></a><span class="kw">cor</span>(df.testa<span class="op">$</span>dummy,df.testa<span class="op">$</span>Predre)<span class="op">^</span><span class="dv">2</span> [<span class="dv">1</span>] <span class="fl">0.9978655</span></span>
<span id="cb25-9"><a href="country-driven-global-mapping-approach.html#cb25-9"></a></span>
<span id="cb25-10"><a href="country-driven-global-mapping-approach.html#cb25-10"></a><span class="co">#Compare the spatial prediction and validation dataset</span></span>
<span id="cb25-11"><a href="country-driven-global-mapping-approach.html#cb25-11"></a><span class="kw">featureRep</span>(predictors[<span class="st">&quot;ECse&quot;</span>],df.testa) <span class="co">#Figure 5.10</span></span>
<span id="cb25-12"><a href="country-driven-global-mapping-approach.html#cb25-12"></a><span class="kw">summary</span>(predictors<span class="op">$</span>ECse);<span class="kw">summary</span>(df.testa<span class="op">$</span>dummy)</span>
<span id="cb25-13"><a href="country-driven-global-mapping-approach.html#cb25-13"></a><span class="co"># Min.	1st Qu.	Median	Mean	3rd Qu.	Max.</span></span>
<span id="cb25-14"><a href="country-driven-global-mapping-approach.html#cb25-14"></a><span class="co"># 0.00007	0.48810	1.17487	1.51685	1.61781	112.74435</span></span>
<span id="cb25-15"><a href="country-driven-global-mapping-approach.html#cb25-15"></a><span class="co"># Min.	1st Qu.	Median	Mean	3rd Qu.	Max.</span></span>
<span id="cb25-16"><a href="country-driven-global-mapping-approach.html#cb25-16"></a><span class="co"># 0.00048	0.59755	1.71126	6.60388	5.05220	113.50941</span></span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.10.PNG" alt="" />
<p class="caption">Figure 5:10: Representativeness of validation (sample points) EC ranges in prediction map (feature map)</p>
</div>
<p>The feature representation in Figure 5.10 shows how well the range of measured EC (validation EC) are contained in the prediction map. In the case-study sample, high EC (&gt;40 dS/m) seem to have been poorly captured in the prediction map. The x-axis shows the frequency (probability density) of occurrence of data (EC) values in y-axis. Poor representation of the high (EC &gt; 40) implies model uncertainty for high EC values. This will be further investigated when uncertainties are produced.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="country-driven-global-mapping-approach.html#cb26-1"></a><span class="co">#Step 2-4: Export the output</span></span>
<span id="cb26-2"><a href="country-driven-global-mapping-approach.html#cb26-2"></a></span>
<span id="cb26-3"><a href="country-driven-global-mapping-approach.html#cb26-3"></a><span class="kw">writeGDAL</span>(predictors[<span class="st">&quot;ECse&quot;</span>], <span class="dt">drivername =</span> <span class="st">&quot;GTiff&quot;</span>, <span class="st">&quot;Top0_30ECse.tif&quot;</span>)</span></code></pre></div>
<p><em>Uncertainty assessment</em><br />
The general spatial model for digital soil mapping is generally given as</p>
<p><span class="math display">\[\begin{equation}
\tag{5.5}
y = f(X) + \varepsilon
\end{equation}\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the target soil variable to be mapped, <span class="math inline">\(X\)</span> is a vector of spatial predictors (controlling factors of causes or drives for salt problems), <span class="math inline">\(\varepsilon\)</span> is the error term, and <span class="math inline">\(f\)</span> is the link function between the target soil variable and its drivers/forming factors. The nature of <span class="math inline">\(f\)</span> is unknown and is approximated by mathematical models. These model approximations, denoted as <span class="math inline">\(\bar{f}\)</span>, give estimates of <span class="math inline">\(y\)</span> which are also denoted as <span class="math inline">\(\bar{y}\)</span>. The difference between <span class="math inline">\(y\)</span> and <span class="math inline">\(\bar{y}\)</span> is the uncertain quantity.</p>
<p><span class="math display">\[\begin{equation}
\tag{5.6}
\bar{y} = \bar{f}(X)
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\tag{5.7}
y - \bar{y} = [f(X) + \varepsilon] - \bar{f}(X)\\
= [f(x) -\]+ \varepsilon
\end{equation}\]</span></p>
<p>In this Book, the uncertain quantity is estimated using prediction width at 95% confidence interval. predUncertain function in soilassessment package is used to extract the uncertainty by bootstrap approach (Efron, 1992). The inputs for the function are a list of predictors, input soil indicator, and the chosen link model (which is taken from the suitable model for map development in Section 5.3.1).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="country-driven-global-mapping-approach.html#cb27-1"></a><span class="co">#Step 2-6: Uncertainty assessment</span></span>
<span id="cb27-2"><a href="country-driven-global-mapping-approach.html#cb27-2"></a>soil6a=soil1[,<span class="kw">c</span>(<span class="st">&quot;Tran&quot;</span>)]</span>
<span id="cb27-3"><a href="country-driven-global-mapping-approach.html#cb27-3"></a>predictors6a=predictors[<span class="kw">c</span>(<span class="st">&quot;dem&quot;</span>,<span class="st">&quot;slope&quot;</span>,<span class="st">&quot;cnbl&quot;</span>,<span class="st">&quot;lcover&quot;</span>,<span class="st">&quot;loncurve&quot;</span>,<span class="st">&quot;rain&quot;</span>,<span class="st">&quot;pgeology&quot;</span></span>
<span id="cb27-4"><a href="country-driven-global-mapping-approach.html#cb27-4"></a>,<span class="st">&quot;geology&quot;</span>,<span class="st">&quot;ls&quot;</span>,<span class="st">&quot;valley&quot;</span>,<span class="st">&quot;PCA1&quot;</span>,<span class="st">&quot;PCA2&quot;</span>,<span class="st">&quot;PCA3&quot;</span>,<span class="st">&quot;PCA4&quot;</span>,<span class="st">&quot;PCA5&quot;</span>)]</span>
<span id="cb27-5"><a href="country-driven-global-mapping-approach.html#cb27-5"></a></span>
<span id="cb27-6"><a href="country-driven-global-mapping-approach.html#cb27-6"></a>pred_uncerta=<span class="kw">predUncertain</span>(soil6a,predictors6a,<span class="dv">3</span>,<span class="dv">95</span>,<span class="st">&quot;qrandomforest&quot;</span>)</span>
<span id="cb27-7"><a href="country-driven-global-mapping-approach.html#cb27-7"></a></span>
<span id="cb27-8"><a href="country-driven-global-mapping-approach.html#cb27-8"></a></span>
<span id="cb27-9"><a href="country-driven-global-mapping-approach.html#cb27-9"></a><span class="kw">spplot</span>(pred_uncerta, <span class="st">&quot;pred_width&quot;</span>, <span class="dt">scales =</span> <span class="kw">list</span>(<span class="dt">draw =</span> <span class="ot">TRUE</span>),<span class="dt">col.regions=</span>heat.color <span class="kw">s</span>(<span class="dv">20</span>,<span class="dt">rev =</span> <span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">spplot</span>(df.testa,<span class="st">&quot;dummy&quot;</span>,<span class="dt">pch=</span><span class="dv">3</span>,<span class="dt">cex=</span><span class="fl">0.4</span>) <span class="co">#Figure 6.11</span></span>
<span id="cb27-10"><a href="country-driven-global-mapping-approach.html#cb27-10"></a></span>
<span id="cb27-11"><a href="country-driven-global-mapping-approach.html#cb27-11"></a></span>
<span id="cb27-12"><a href="country-driven-global-mapping-approach.html#cb27-12"></a><span class="co">#Step 2-7: Exporting the uncertainty maps</span></span>
<span id="cb27-13"><a href="country-driven-global-mapping-approach.html#cb27-13"></a>EC0_<span class="dv">30</span>_uncertain=(pred_uncerta<span class="op">$</span>pred_width<span class="op">*</span>lmbda1<span class="op">+</span><span class="dv">1</span>)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>lmbda1)</span>
<span id="cb27-14"><a href="country-driven-global-mapping-approach.html#cb27-14"></a><span class="kw">writeRaster</span>(EC0_<span class="dv">30</span>_uncertain, <span class="dt">filename=</span><span class="st">&quot;EC0_30_uncertain.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.11.PNG" alt="" />
<p class="caption">Figure 5.11: Spatial prediction width at 95% confidence interval and overlay of validation points</p>
</div>
<p>The steps for spatial modelling of EC should be repeated for pH, ESP and soluble ions for 30-100 cm soil depths. Altogether, the final products form the spatial information of indicators of salt-affected soils at 0- 30 cm and 30-100 cm soil depths.</p>
</div>
</div>
<div id="part-3-spatial-modelling-of-salt-affected-soils" class="section level2">
<h2><span class="header-section-number">5.4</span> Part 3: Spatial modelling of salt-affected soils</h2>
<div id="spatial-modelling-of-salt-affected-soils" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Spatial modelling of salt-affected soils</h3>
<p>This section describes the approach for spatial modelling of salt-affected soils based on input maps of soil indicators of salt problems. It is the final step of the multiscale approach in Figure 5.1. Spatial modelling approach for salt-affected soils is focused on:</p>
<ol style="list-style-type: decimal">
<li>Classification of salt-affected areas;</li>
<li>Identification of intensity of the salt problems;</li>
<li>Assessment of uncertainty in developing maps of salt-affected soils. The mathematical model for classifying salt-affected soils is given here as</li>
</ol>
<p><span class="math display">\[\begin{equation}
\tag{5.8}
salt = g(EC,pH,ESP) + error
\end{equation}\]</span></p>
<p>where <em>salt</em> is the class of type or intensity of the salt problems and error is the difference between the actual and modelled values classes. Proposed estimations for the model <span class="math inline">\(g\)</span> in the literature are given in Table 2.4 and Table 2.5. The soilassessment package contains the functions saltClass, saltSeverity and saltRating for implementing these models. The input data for saltClass and saltSeverity functions are the three soil indicators, EC, pH, and ESP. saltRating functions give the major classes of salt-affected soils using EC and pH only. It’s an approximation for indicative classes which need improvement with data from sodium salts. The input data for classifying salt-affected soils can be point-data in a spreadsheet dataframe or raster maps.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="country-driven-global-mapping-approach.html#cb28-1"></a><span class="co">#Step 3-1: Classifying types of salt-affected soils</span></span>
<span id="cb28-2"><a href="country-driven-global-mapping-approach.html#cb28-2"></a>predictors<span class="op">$</span>salty=<span class="kw">saltClass</span>(predictors<span class="op">$</span>ECse,predictors<span class="op">$</span>PH,predictors<span class="op">$</span>ESP,<span class="st">&quot;FAO&quot;</span>)</span>
<span id="cb28-3"><a href="country-driven-global-mapping-approach.html#cb28-3"></a><span class="kw">summary</span>(predictors<span class="op">$</span>salty)</span>
<span id="cb28-4"><a href="country-driven-global-mapping-approach.html#cb28-4"></a></span>
<span id="cb28-5"><a href="country-driven-global-mapping-approach.html#cb28-5"></a><span class="co">#Min. 1st Qu.	Median	Mean 3rd Qu.	Max.</span></span>
<span id="cb28-6"><a href="country-driven-global-mapping-approach.html#cb28-6"></a><span class="co">#1.000	1.000	1.000	1.151	1.000	5.000</span></span>
<span id="cb28-7"><a href="country-driven-global-mapping-approach.html#cb28-7"></a></span>
<span id="cb28-8"><a href="country-driven-global-mapping-approach.html#cb28-8"></a>predictors<span class="op">$</span>saltiness=<span class="kw">classCode</span>(predictors<span class="op">$</span>salty,<span class="st">&quot;saltclass&quot;</span>)</span>
<span id="cb28-9"><a href="country-driven-global-mapping-approach.html#cb28-9"></a><span class="kw">spplot</span>(predictors[<span class="st">&quot;salty&quot;</span>])</span>
<span id="cb28-10"><a href="country-driven-global-mapping-approach.html#cb28-10"></a><span class="kw">spplot</span>(predictors[<span class="st">&quot;saltiness&quot;</span>]) <span class="co"># Figure 5.12a</span></span>
<span id="cb28-11"><a href="country-driven-global-mapping-approach.html#cb28-11"></a>predictors<span class="op">$</span>Salt_affected=<span class="kw">saltSeverity</span>(predictors<span class="op">$</span>ECse,predictors<span class="op">$</span>PH,predictors<span class="op">$</span>ESP,<span class="st">&quot; FAO&quot;</span>)	predictors<span class="op">$</span>saltaffectedness=<span class="kw">classCode</span>(predictors<span class="op">$</span>Salt_affected,<span class="st">&quot;saltseverity&quot;</span>)</span>
<span id="cb28-12"><a href="country-driven-global-mapping-approach.html#cb28-12"></a><span class="kw">spplot</span>(predictors[<span class="st">&quot;saltaffectedness&quot;</span>]) <span class="co"># Figure 5.12b</span></span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.12.PNG" alt="" />
<p class="caption">Figure 5.12: Maps of salt-affected soils (0-30 cm)</p>
</div>
<p>The final maps in Figure 5.12 are exported as a GIS file format for use with other GIS software (such as QGIS) or for data sharing. Since the export function does not work with factors /character values, the salt classes in the maps are first converted into numeric map-values and then exported. A look-up table (LUT) is necessary to help identify the classes and the unique numeric codes generated for each map-value. The LUT is exported as a text-file.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="country-driven-global-mapping-approach.html#cb29-1"></a><span class="co">#Step 3-2: Exporting the maps</span></span>
<span id="cb29-2"><a href="country-driven-global-mapping-approach.html#cb29-2"></a>predictors<span class="op">$</span>Saltclass=<span class="kw">as.numeric</span>(predictors<span class="op">$</span>saltaffectedness)</span>
<span id="cb29-3"><a href="country-driven-global-mapping-approach.html#cb29-3"></a>salinity_LUT30=<span class="kw">classLUT</span>(predictors[<span class="st">&quot;saltaffectedness&quot;</span>],<span class="st">&quot;saltseverity&quot;</span>)</span>
<span id="cb29-4"><a href="country-driven-global-mapping-approach.html#cb29-4"></a></span>
<span id="cb29-5"><a href="country-driven-global-mapping-approach.html#cb29-5"></a><span class="kw">writeGDAL</span>(predictors[<span class="st">&quot;Saltclass&quot;</span>], <span class="dt">drivername =</span> <span class="st">&quot;GTiff&quot;</span>, <span class="st">&quot;Top0_30saltaffected.tif&quot;</span>)</span>
<span id="cb29-6"><a href="country-driven-global-mapping-approach.html#cb29-6"></a><span class="kw">write.table</span>(salinity_LUT30,<span class="dt">file =</span> <span class="st">&quot;saltaffected_LUT30.txt&quot;</span>,<span class="dt">row.names =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
</div>
<div id="accuracy-assessment" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Accuracy assessment</h3>
<p>Accuracy of classified salt-affected map is assessed using confusion matrix. In this strategy holdout samples are independently classified in terms of types and severity of salt problems in the soil. Classification of the holdout samples should follow the same procedure of harmonization as other input data (that is, harmonization of input indicators and depths 0-30 and 30-100 cm). These classes are then compared to the pixel-extracted classes from the classified maps. The Kappa index is a suitable indicator for reporting the accuracy.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="country-driven-global-mapping-approach.html#cb30-1"></a><span class="co">#Step 3-2: Import and classify validation dataset</span></span>
<span id="cb30-2"><a href="country-driven-global-mapping-approach.html#cb30-2"></a>soilv=<span class="kw">readOGR</span>(<span class="st">&quot;.&quot;</span>,<span class="st">&quot;validation_harmonized&quot;</span>)</span>
<span id="cb30-3"><a href="country-driven-global-mapping-approach.html#cb30-3"></a>soilv=<span class="kw">subset</span>(soilv,soilv<span class="op">$</span>Horizon<span class="op">==</span><span class="dv">1</span>)</span>
<span id="cb30-4"><a href="country-driven-global-mapping-approach.html#cb30-4"></a>soilv<span class="op">$</span>salt_affected1=<span class="kw">saltSeverity</span>(soilv<span class="op">$</span>EC,soilv<span class="op">$</span>pH,soilv<span class="op">$</span>ESP,<span class="st">&quot;FAO&quot;</span>)</span>
<span id="cb30-5"><a href="country-driven-global-mapping-approach.html#cb30-5"></a><span class="kw">summary</span>(soilv<span class="op">$</span>salt_affected1)</span>
<span id="cb30-6"><a href="country-driven-global-mapping-approach.html#cb30-6"></a><span class="co"># Min. 1st Qu.	Median	Mean 3rd Qu.	Max. 3.0	6.0		8.0		8.5	#11.5	15.0</span></span>
<span id="cb30-7"><a href="country-driven-global-mapping-approach.html#cb30-7"></a></span>
<span id="cb30-8"><a href="country-driven-global-mapping-approach.html#cb30-8"></a>soilv<span class="op">$</span>saltaffectedness1=<span class="kw">classCode</span>(soilv<span class="op">$</span>salt_affected1,<span class="st">&quot;saltseverity&quot;</span>)</span>
<span id="cb30-9"><a href="country-driven-global-mapping-approach.html#cb30-9"></a><span class="kw">summary</span>(soilv<span class="op">$</span>saltaffectedness1)</span></code></pre></div>
<p>After classifying the validation dataset, the dataset is used to extract pixel values of the classified map and compared with the classified validation.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="country-driven-global-mapping-approach.html#cb31-1"></a><span class="co">#Step 3-3: Extract the salt classes from the map using the validation samples</span></span>
<span id="cb31-2"><a href="country-driven-global-mapping-approach.html#cb31-2"></a>soilv=<span class="kw">subset</span>(soilv,<span class="op">!</span><span class="kw">is.na</span>(soilv<span class="op">$</span>saltaffectedness1))</span>
<span id="cb31-3"><a href="country-driven-global-mapping-approach.html#cb31-3"></a>predictors.ovv=<span class="kw">over</span>(soilv, predictors)</span>
<span id="cb31-4"><a href="country-driven-global-mapping-approach.html#cb31-4"></a>soilv<span class="op">$</span>salt_affected=predictors.ovv<span class="op">$</span>Salt_affected</span>
<span id="cb31-5"><a href="country-driven-global-mapping-approach.html#cb31-5"></a>soilv<span class="op">$</span>saltaffectedness=predictors.ovv<span class="op">$</span>saltaffectedness</span>
<span id="cb31-6"><a href="country-driven-global-mapping-approach.html#cb31-6"></a><span class="co"># Check the summary of extracted classified pixels</span></span>
<span id="cb31-7"><a href="country-driven-global-mapping-approach.html#cb31-7"></a><span class="kw">summary</span>(soilv<span class="op">$</span>salt_affected)</span>
<span id="cb31-8"><a href="country-driven-global-mapping-approach.html#cb31-8"></a></span>
<span id="cb31-9"><a href="country-driven-global-mapping-approach.html#cb31-9"></a><span class="kw">summary</span>(soilv<span class="op">$</span>saltaffectedness)</span></code></pre></div>
<p>A visual comparison shows that the validation datasets had points classified as extremely saline soil, but the map reported only one pixel. Similarly, three points in the validation datasets had strong salinity class while the map had 10 pixels with strong salinity classes. A graphical plot of the comparison (confusion matrix) gives a clear picture of the accuracy (Figure 5.13).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="country-driven-global-mapping-approach.html#cb32-1"></a><span class="co"># Plot the confusion matrix and determine the Kappa index</span></span>
<span id="cb32-2"><a href="country-driven-global-mapping-approach.html#cb32-2"></a><span class="kw">agreementplot</span>(<span class="kw">confusion</span>(soilv<span class="op">$</span>salt_affected, soilv<span class="op">$</span>salt_affected1),<span class="dt">main =</span> <span class="st">&quot;Accuracy assessment&quot;</span>,<span class="dt">xlab =</span> <span class="st">&quot;Class codes in holdout samples&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Class codes in map&quot;</span>)</span>
<span id="cb32-3"><a href="country-driven-global-mapping-approach.html#cb32-3"></a><span class="kw">Kappa</span>(<span class="kw">confusion</span>(soilv<span class="op">$</span>salt_affected, soilv<span class="op">$</span>salt_affected1)) </span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.13.png" alt="" />
<p class="caption">Figure 5.13: Graphical illustration of classification accuracy for salt-affected soils</p>
</div>
</div>
<div id="uncertainty-assessment" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Uncertainty assessment</h3>
<p>Uncertainty assessment in salt-affected modelling is conceived as estimating uncertainties contributed by input data modelling and uncertainties from the salt-classification model. The Monte Carlo uncertainty propagation approach is used to model both input data uncertainty and classification model uncertainty (Sawicka et al., 2018). This is a three-step approach involving input parameter specification, development of marginal and joint distributions, and simulations for uncertainty propagation (Figure 5.14). Input parameter specifications comprise definition of the salt-classification model (Equation 5.8) and spatial distribution of mean and variance of the input variables. Spatial distribution of mean and variance are used to train the MC simulations at a set number of simulations/realizations. Usually, MC simulations are more accurate with a higher number of realizations. However, this may cost the analysis computing time for large datasets. A trade-off is necessary to safeguard suitable accuracy while at the same time incurring moderate computing time. A value of 100 is suggested for modelling salt-affected soils.</p>
<div class="figure">
<img src="figures/images/Figure5.14.png" alt="" />
<p class="caption">Figure 5.14: Monte Carlo uncertainty estimation process</p>
</div>
<p>Development of marginal density functions uses statistical distribution parameters and correlation models (crm). Examples of statistical distribution parameters, which depend on the type of distribution, are the mean(??????????) and standard variation (????????) for normal distribution or the scale (???) and rate (??) for gamma distribution.
The following steps describes the process for preparing the input indicator maps into raster file format, since the modules for uncertainty assessment were developed for the raster file format. The input maps are further converted into spatialPixelsDataFrame to facilitate mathematical operations on dataframes. It is important to check the probability distributions of the input data using the histogram function. Although MC simulations in Figure 5.14 are not strict on the type of the distribution, normal distribution is easy to sample. It’s therefore recommended that normalized distributions be established from the input maps.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="country-driven-global-mapping-approach.html#cb33-1"></a><span class="co">#Step 3-4: Convert the input layers into raster files</span></span>
<span id="cb33-2"><a href="country-driven-global-mapping-approach.html#cb33-2"></a>EC=<span class="kw">raster</span>(predictors[<span class="st">&quot;ECse&quot;</span>]);<span class="kw">names</span>(EC)=<span class="kw">c</span>(<span class="st">&quot;EC&quot;</span>); EC1=<span class="kw">as</span>(EC,<span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb33-3"><a href="country-driven-global-mapping-approach.html#cb33-3"></a>PH=<span class="kw">raster</span>(predictors[<span class="st">&quot;PH&quot;</span>]); <span class="kw">names</span>(PH)=<span class="kw">c</span>(<span class="st">&quot;PH&quot;</span>); PH1=<span class="kw">as</span>(PH,<span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb33-4"><a href="country-driven-global-mapping-approach.html#cb33-4"></a>ESP=<span class="kw">raster</span>(predictors[<span class="st">&quot;ESP&quot;</span>]);<span class="kw">names</span>(EC)=<span class="kw">c</span>(<span class="st">&quot;ESP&quot;</span>);ESP1=<span class="kw">as</span>(ESP,<span class="st">&quot;SpatialPixelsDataFrame &quot;</span>)</span>
<span id="cb33-5"><a href="country-driven-global-mapping-approach.html#cb33-5"></a></span>
<span id="cb33-6"><a href="country-driven-global-mapping-approach.html#cb33-6"></a>ECte=<span class="kw">raster</span>(predictors[<span class="st">&quot;ECte&quot;</span>]);ECsd=pred_uncerta<span class="op">$</span>pred_sd; <span class="kw">names</span>(ECsd)=<span class="kw">c</span>(<span class="st">&quot;ECsd&quot;</span>)</span>
<span id="cb33-7"><a href="country-driven-global-mapping-approach.html#cb33-7"></a>PHde=<span class="kw">raster</span>(predictors[<span class="st">&quot;PHt&quot;</span>]);PHsd=pred_uncertb<span class="op">$</span>pred_sd; <span class="kw">names</span>(PHsd)=<span class="kw">c</span>(<span class="st">&quot;PHsd&quot;</span>)</span>
<span id="cb33-8"><a href="country-driven-global-mapping-approach.html#cb33-8"></a>ESPt=<span class="kw">raster</span>(predictors[<span class="st">&quot;ESPt&quot;</span>]);ESPsd=pred_uncertc<span class="op">$</span>pred_sd; <span class="kw">names</span>(ESPsd)=<span class="kw">c</span>(<span class="st">&quot;ESPsd&quot;</span>)</span>
<span id="cb33-9"><a href="country-driven-global-mapping-approach.html#cb33-9"></a></span>
<span id="cb33-10"><a href="country-driven-global-mapping-approach.html#cb33-10"></a><span class="co"># Obtain sample spatial autocorrelation (Figure 5.15)</span></span>
<span id="cb33-11"><a href="country-driven-global-mapping-approach.html#cb33-11"></a>b=<span class="kw">nrow</span>(EC1)</span>
<span id="cb33-12"><a href="country-driven-global-mapping-approach.html#cb33-12"></a>c=<span class="kw">trunc</span>(<span class="fl">0.01</span><span class="op">*</span>b)</span>
<span id="cb33-13"><a href="country-driven-global-mapping-approach.html#cb33-13"></a>jj=EC1[<span class="kw">sample</span>(b,c),]</span>
<span id="cb33-14"><a href="country-driven-global-mapping-approach.html#cb33-14"></a>vrm=<span class="kw">autofitVariogram</span>(EC<span class="op">~</span><span class="dv">1</span>,jj)</span>
<span id="cb33-15"><a href="country-driven-global-mapping-approach.html#cb33-15"></a></span>
<span id="cb33-16"><a href="country-driven-global-mapping-approach.html#cb33-16"></a><span class="kw">plot</span>(vrm)<span class="co">#Note the spatial correlation model and the value of Range parameter</span></span>
<span id="cb33-17"><a href="country-driven-global-mapping-approach.html#cb33-17"></a><span class="kw">acf</span>((EC1<span class="op">$</span>EC)) <span class="co">##Also not the acf0 (at lag 0)</span></span>
<span id="cb33-18"><a href="country-driven-global-mapping-approach.html#cb33-18"></a>EC_crm &lt;-<span class="st"> </span><span class="kw">makeCRM</span>(<span class="dt">acf0 =</span> <span class="fl">0.85</span>, <span class="dt">range =</span> <span class="dv">20000</span>, <span class="dt">model =</span> <span class="st">&quot;Sph&quot;</span>)</span>
<span id="cb33-19"><a href="country-driven-global-mapping-approach.html#cb33-19"></a><span class="kw">plot</span>(EC_crm, <span class="dt">main =</span> <span class="st">&quot;EC correlogram&quot;</span>)</span></code></pre></div>
<p>The above correlation functions are repeated for all input soil indicators for 0-30 cm and 30-100 cm.</p>
<div class="figure">
<img src="figures/images/Figure5.15.PNG" alt="" />
<p class="caption">Figure 5.15: Correlation functions for EC (0-30 cm)</p>
</div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="country-driven-global-mapping-approach.html#cb34-1"></a><span class="co">#Step 3-5: Develop input marginal and joint multivariate uncertainty models for defining MC models</span></span>
<span id="cb34-2"><a href="country-driven-global-mapping-approach.html#cb34-2"></a>EC_UM=<span class="kw">defineUM</span>(<span class="dt">distribution=</span><span class="st">&quot;norm&quot;</span>,<span class="dt">distr_param =</span> <span class="kw">c</span>(ECte,ECsd),<span class="dt">crm =</span>EC_crm,<span class="dt">id =</span> <span class="st">&quot;EC&quot;</span>)</span>
<span id="cb34-3"><a href="country-driven-global-mapping-approach.html#cb34-3"></a>PH_UM=<span class="kw">defineUM</span>(<span class="dt">distribution =</span><span class="st">&quot;norm&quot;</span>,<span class="dt">distr_param =</span><span class="kw">c</span>(PHde,PHsd),<span class="dt">crm =</span>PH_crm,<span class="dt">id =</span> <span class="st">&quot;PH&quot;</span>)</span>
<span id="cb34-4"><a href="country-driven-global-mapping-approach.html#cb34-4"></a>ESP_UM=<span class="kw">defineUM</span>(<span class="dt">distribution=</span><span class="st">&quot;norm&quot;</span>,<span class="dt">distr_param=</span><span class="kw">c</span>(ESPt,ESPsd),<span class="dt">crm=</span>ESP_crm,<span class="dt">id=</span> <span class="st">&quot;ESP&quot;</span>)</span>
<span id="cb34-5"><a href="country-driven-global-mapping-approach.html#cb34-5"></a><span class="kw">class</span>(EC_UM);<span class="kw">class</span>(PH_UM);<span class="kw">class</span>(ESP_UM)</span>
<span id="cb34-6"><a href="country-driven-global-mapping-approach.html#cb34-6"></a><span class="co"># [1] &quot;MarginalNumericSpatial&quot;</span></span>
<span id="cb34-7"><a href="country-driven-global-mapping-approach.html#cb34-7"></a><span class="co"># [1] &quot;MarginalNumericSpatial&quot;</span></span>
<span id="cb34-8"><a href="country-driven-global-mapping-approach.html#cb34-8"></a><span class="co"># [1] &quot;MarginalNumericSpatial&quot;</span></span>
<span id="cb34-9"><a href="country-driven-global-mapping-approach.html#cb34-9"></a></span>
<span id="cb34-10"><a href="country-driven-global-mapping-approach.html#cb34-10"></a></span>
<span id="cb34-11"><a href="country-driven-global-mapping-approach.html#cb34-11"></a><span class="co">#Get the correlation values and use them in defining the Monte Carlo Uncertainty Mode (MUM)</span></span>
<span id="cb34-12"><a href="country-driven-global-mapping-approach.html#cb34-12"></a><span class="kw">cor</span>(<span class="kw">values</span>(ECte),<span class="kw">values</span>(PHde)); <span class="kw">cor</span>(<span class="kw">values</span>(ECte),<span class="kw">values</span>(ESPt)); <span class="kw">cor</span>(<span class="kw">values</span>(PHde),val <span class="kw">ues</span>(ESPt))</span>
<span id="cb34-13"><a href="country-driven-global-mapping-approach.html#cb34-13"></a><span class="co"># [1] 0.5511048</span></span>
<span id="cb34-14"><a href="country-driven-global-mapping-approach.html#cb34-14"></a><span class="co"># [1] 0.3204495</span></span>
<span id="cb34-15"><a href="country-driven-global-mapping-approach.html#cb34-15"></a><span class="co"># [1] 0.2859129</span></span>
<span id="cb34-16"><a href="country-driven-global-mapping-approach.html#cb34-16"></a></span>
<span id="cb34-17"><a href="country-driven-global-mapping-approach.html#cb34-17"></a>		salinityMUM =<span class="st"> </span><span class="kw">defineMUM</span>(<span class="dt">UMlist =</span> <span class="kw">list</span>(EC_UM, PH_UM, ESP_UM), <span class="dt">cormatrix =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">cor</span>(<span class="kw">values</span>(ECte),<span class="kw">values</span>(PHde)), <span class="kw">cor</span>(<span class="kw">values</span>(ECte),<span class="kw">values</span>(ESPt)), <span class="kw">cor</span>(<span class="kw">values</span>(ECte), <span class="kw">values</span>(PHde)), <span class="dv">1</span>, <span class="kw">cor</span>(<span class="kw">values</span>(PHde), <span class="kw">values</span>(ESPt)), <span class="kw">cor</span>(<span class="kw">values</span>(ECte), <span class="kw">values</span>(ESPt)), <span class="kw">cor</span>(<span class="kw">values</span>(PHde), <span class="kw">values</span>(ESPt)),<span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>))</span>
<span id="cb34-18"><a href="country-driven-global-mapping-approach.html#cb34-18"></a></span>
<span id="cb34-19"><a href="country-driven-global-mapping-approach.html#cb34-19"></a>	<span class="kw">class</span>(salinityMUM)</span>
<span id="cb34-20"><a href="country-driven-global-mapping-approach.html#cb34-20"></a><span class="co">#[1] &quot;JointNumericSpatial&quot;</span></span></code></pre></div>
<p>Possible realizations are now developed after setting the Monte Carlo Uncertainty models (MUM). 100 level is set for simulating the MC simulations.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="country-driven-global-mapping-approach.html#cb35-1"></a><span class="co">#Step 3-6: Create MC realizations from the distributions</span></span>
<span id="cb35-2"><a href="country-driven-global-mapping-approach.html#cb35-2"></a>	MC &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb35-3"><a href="country-driven-global-mapping-approach.html#cb35-3"></a>	input_sample =<span class="st"> </span><span class="kw">genSample</span>(<span class="dt">UMobject =</span> salinityMUM, <span class="dt">n =</span> MC, <span class="dt">samplemethod =</span> <span class="st">&quot;ugs&quot;</span>,	nmax</span>
<span id="cb35-4"><a href="country-driven-global-mapping-approach.html#cb35-4"></a>=<span class="st"> </span><span class="dv">20</span>, <span class="dt">asList =</span> <span class="ot">FALSE</span>)</span>
<span id="cb35-5"><a href="country-driven-global-mapping-approach.html#cb35-5"></a>Linear Model of Coregionalization found. Good. [using unconditional Gaussian cosimulation]</span>
<span id="cb35-6"><a href="country-driven-global-mapping-approach.html#cb35-6"></a></span>
<span id="cb35-7"><a href="country-driven-global-mapping-approach.html#cb35-7"></a><span class="co"># Compute input sample statistics</span></span>
<span id="cb35-8"><a href="country-driven-global-mapping-approach.html#cb35-8"></a>EC_sample =<span class="st"> </span>input_sample[[<span class="dv">1</span><span class="op">:</span>MC]]</span>
<span id="cb35-9"><a href="country-driven-global-mapping-approach.html#cb35-9"></a>PH_sample =<span class="st"> </span>input_sample[[(MC<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">2</span><span class="op">*</span>MC)]]</span>
<span id="cb35-10"><a href="country-driven-global-mapping-approach.html#cb35-10"></a>ESP_sample =<span class="st"> </span>input_sample[[(<span class="dv">2</span><span class="op">*</span>MC<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>(<span class="dv">3</span><span class="op">*</span>MC)]]</span>
<span id="cb35-11"><a href="country-driven-global-mapping-approach.html#cb35-11"></a>EC_sample_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(EC_sample)</span>
<span id="cb35-12"><a href="country-driven-global-mapping-approach.html#cb35-12"></a></span>
<span id="cb35-13"><a href="country-driven-global-mapping-approach.html#cb35-13"></a></span>
<span id="cb35-14"><a href="country-driven-global-mapping-approach.html#cb35-14"></a>PH_sample_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(PH_sample)</span>
<span id="cb35-15"><a href="country-driven-global-mapping-approach.html#cb35-15"></a>ESP_sample_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(ESP_sample)</span>
<span id="cb35-16"><a href="country-driven-global-mapping-approach.html#cb35-16"></a></span>
<span id="cb35-17"><a href="country-driven-global-mapping-approach.html#cb35-17"></a>EC_sample_sd &lt;-<span class="st"> </span><span class="kw">calc</span>(EC_sample, <span class="dt">fun =</span> sd)</span>
<span id="cb35-18"><a href="country-driven-global-mapping-approach.html#cb35-18"></a>PH_sample_sd &lt;-<span class="st"> </span><span class="kw">calc</span>(PH_sample, <span class="dt">fun =</span> sd)</span>
<span id="cb35-19"><a href="country-driven-global-mapping-approach.html#cb35-19"></a>ESP_sample_sd &lt;-<span class="st"> </span><span class="kw">calc</span>(ESP_sample, <span class="dt">fun =</span> sd)</span>
<span id="cb35-20"><a href="country-driven-global-mapping-approach.html#cb35-20"></a></span>
<span id="cb35-21"><a href="country-driven-global-mapping-approach.html#cb35-21"></a><span class="co">#Plot the realizations</span></span>
<span id="cb35-22"><a href="country-driven-global-mapping-approach.html#cb35-22"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.7</span>, <span class="fl">0.5</span>, <span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb35-23"><a href="country-driven-global-mapping-approach.html#cb35-23"></a><span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">cex.main =</span> <span class="dv">1</span>, <span class="dt">tcl =</span> <span class="fl">-0.2</span>, <span class="dt">cex.axis =</span> <span class="fl">0.8</span>, <span class="dt">cex.lab =</span> <span class="fl">0.8</span>)</span>
<span id="cb35-24"><a href="country-driven-global-mapping-approach.html#cb35-24"></a><span class="kw">plot</span>(EC_sample_mean, <span class="dt">main =</span> <span class="st">&quot;Mean of ECt realizations&quot;</span>, <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb35-25"><a href="country-driven-global-mapping-approach.html#cb35-25"></a><span class="kw">plot</span>(PH_sample_mean, <span class="dt">main =</span> <span class="st">&quot;Mean of PHt realizations&quot;</span>, <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb35-26"><a href="country-driven-global-mapping-approach.html#cb35-26"></a><span class="kw">plot</span>(ESP_sample_mean, <span class="dt">main =</span> <span class="st">&quot;Mean of ESPt realizations&quot;</span>, <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p>Note that the MC simulations were done on the normalized input soil indicators. It’s possible to sample
from non-normalized data. However, a harmonized statistical distribution is use in this book.
The uncertainty propagation model is used to determine how uncertainties in input soil indicators
propagate through the classification model into the final classified map.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="country-driven-global-mapping-approach.html#cb36-1"></a><span class="co">#Step 3-7: Uncertainty propagation through the classification model</span></span>
<span id="cb36-2"><a href="country-driven-global-mapping-approach.html#cb36-2"></a>	Salinity_model_raster &lt;-<span class="st"> </span><span class="cf">function</span> (EC1,PH1,ESP1){</span>
<span id="cb36-3"><a href="country-driven-global-mapping-approach.html#cb36-3"></a><span class="op">+</span>	ww=EC1</span>
<span id="cb36-4"><a href="country-driven-global-mapping-approach.html#cb36-4"></a><span class="op">+</span>	ww=<span class="kw">raster</span>(ww)</span>
<span id="cb36-5"><a href="country-driven-global-mapping-approach.html#cb36-5"></a><span class="op">+</span>	ww<span class="op">$</span>salt=<span class="kw">saltSeverity</span>(<span class="kw">values</span>(EC1),<span class="kw">values</span>(PH1),<span class="kw">values</span>(ESP1),<span class="st">&quot;FAO&quot;</span>)</span>
<span id="cb36-6"><a href="country-driven-global-mapping-approach.html#cb36-6"></a><span class="op">+</span>	ww=ww<span class="op">$</span>salt; <span class="kw">names</span>(ww)=<span class="kw">c</span>(<span class="st">&quot;salt&quot;</span>)</span>
<span id="cb36-7"><a href="country-driven-global-mapping-approach.html#cb36-7"></a><span class="op">+</span>	ww</span>
<span id="cb36-8"><a href="country-driven-global-mapping-approach.html#cb36-8"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb36-9"><a href="country-driven-global-mapping-approach.html#cb36-9"></a></span>
<span id="cb36-10"><a href="country-driven-global-mapping-approach.html#cb36-10"></a>	v &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb36-11"><a href="country-driven-global-mapping-approach.html#cb36-11"></a>	v[[<span class="dv">1</span>]] =<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="cf">function</span>(x){input_sample[[x]]})</span>
<span id="cb36-12"><a href="country-driven-global-mapping-approach.html#cb36-12"></a>	v[[<span class="dv">2</span>]] =<span class="st"> </span><span class="kw">map</span>(<span class="dv">101</span><span class="op">:</span><span class="dv">200</span>, <span class="cf">function</span>(x){input_sample[[x]]})</span>
<span id="cb36-13"><a href="country-driven-global-mapping-approach.html#cb36-13"></a>	v[[<span class="dv">3</span>]] =<span class="st"> </span><span class="kw">map</span>(<span class="dv">201</span><span class="op">:</span><span class="dv">300</span>, <span class="cf">function</span>(x){input_sample[[x]]})</span>
<span id="cb36-14"><a href="country-driven-global-mapping-approach.html#cb36-14"></a>	input_sample=v</span>
<span id="cb36-15"><a href="country-driven-global-mapping-approach.html#cb36-15"></a>	salinity_sample=<span class="kw">propagate</span>(<span class="dt">realizations=</span>input_sample,<span class="dt">model=</span>Salinity_model_raster,<span class="dt">n=</span>MC</span>
<span id="cb36-16"><a href="country-driven-global-mapping-approach.html#cb36-16"></a>)</span>
<span id="cb36-17"><a href="country-driven-global-mapping-approach.html#cb36-17"></a></span>
<span id="cb36-18"><a href="country-driven-global-mapping-approach.html#cb36-18"></a><span class="co">#Determine the uncertainty in final classified map</span></span>
<span id="cb36-19"><a href="country-driven-global-mapping-approach.html#cb36-19"></a>	samplelist &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb36-20"><a href="country-driven-global-mapping-approach.html#cb36-20"></a>	samplelist [[<span class="dv">1</span>]] =<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="cf">function</span>(x){input_sample[[x]]})</span>
<span id="cb36-21"><a href="country-driven-global-mapping-approach.html#cb36-21"></a>	samplelist [[<span class="dv">2</span>]] =<span class="st"> </span><span class="kw">map</span>(<span class="dv">101</span><span class="op">:</span><span class="dv">200</span>, <span class="cf">function</span>(x){input_sample[[x]]})</span>
<span id="cb36-22"><a href="country-driven-global-mapping-approach.html#cb36-22"></a>	samplelist [[<span class="dv">3</span>]] =<span class="st"> </span><span class="kw">map</span>(<span class="dv">201</span><span class="op">:</span><span class="dv">300</span>, <span class="cf">function</span>(x){input_sample[[x]]})</span>
<span id="cb36-23"><a href="country-driven-global-mapping-approach.html#cb36-23"></a>	input_sample=<span class="st"> </span>samplelist</span>
<span id="cb36-24"><a href="country-driven-global-mapping-approach.html#cb36-24"></a>	salinity_sample =<span class="st"> </span><span class="kw">propagate</span>(<span class="dt">realizations =</span> input_sample, <span class="dt">model =</span> Salinity_model_raster, <span class="dt">n =</span> MC)</span>
<span id="cb36-25"><a href="country-driven-global-mapping-approach.html#cb36-25"></a></span>
<span id="cb36-26"><a href="country-driven-global-mapping-approach.html#cb36-26"></a>	salinity_sample &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">stack</span>(salinity_sample)</span>
<span id="cb36-27"><a href="country-driven-global-mapping-approach.html#cb36-27"></a>	<span class="kw">names</span>(salinity_sample) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;salt.&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nlayers</span>(salinity_sample)), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb36-28"><a href="country-driven-global-mapping-approach.html#cb36-28"></a>	salinity_freq =<span class="st"> </span><span class="kw">modal</span>(salinity_sample, <span class="dt">freq=</span><span class="ot">TRUE</span>)</span>
<span id="cb36-29"><a href="country-driven-global-mapping-approach.html#cb36-29"></a>	salinity_prop =<span class="st"> </span>salinity_fre<span class="op">/</span><span class="dv">100</span></span>
<span id="cb36-30"><a href="country-driven-global-mapping-approach.html#cb36-30"></a>	salinity_SErr =<span class="st"> </span><span class="kw">sqrt</span>(salinity_prop<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>salinity_prop)<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb36-31"><a href="country-driven-global-mapping-approach.html#cb36-31"></a>	CL=<span class="fl">0.95</span></span>
<span id="cb36-32"><a href="country-driven-global-mapping-approach.html#cb36-32"></a>	z_star=<span class="kw">round</span>(<span class="kw">qnorm</span>((<span class="dv">1</span><span class="op">-</span>CL)<span class="op">/</span><span class="dv">2</span>,<span class="dt">lower.tail=</span>F),<span class="dt">digits =</span> <span class="dv">2</span>)</span>
<span id="cb36-33"><a href="country-driven-global-mapping-approach.html#cb36-33"></a>	salinity_MErr=z_star<span class="op">*</span>salinity_SErr</span>
<span id="cb36-34"><a href="country-driven-global-mapping-approach.html#cb36-34"></a>	<span class="kw">writeRaster</span>(salinity_MErr,<span class="dt">filename=</span><span class="st">&quot;Salinity_ME.tif&quot;</span>,<span class="dt">format=</span><span class="st">&quot;GTiff&quot;</span>)</span></code></pre></div>
<p>The final output is exported to a GIS file format for map layout development (Figure 5.17).</p>
<p>Overall classification accuracy of salt-affected topsoils (0-30 cm) was 65%. These soils covered more than 82% of the topsoils in the case-study area (Figure 5.17). Northwest of the area had slight to moderately saline topsoil with pockets of overlying saline-sodic and slightly sodic topsoils. Topsoil salinity seems to be predominant in the eastern side towards the Red Sea. Topsoil sodicity seems to be concentrated along the River Nile (Figure 5.17).
The above steps for developing maps of salt-affected soils and associated uncertainty maps should be repeated for 30-100 cm soil depths.</p>
<p><img src="figures/images/Figure5.17.jpg" alt="Figure 5.17: Map of salt-affected topsoil (0-30 cm) in study area" />
## Map update<br />
### Update needs assessment<br />
Salt problem in the soil is a dynamic phenomenon owing to the changing characteristics of its drivers. It is therefore expected that maps of salt-affected soils will also change with time. Furthermore, the spatial coverage of measured soil indicators is not always exhaustive owing to sampling limitations. Altogether, these factors emphasize the need for planning for updates. The following factors need consideration when planning update for salt-affected soil maps:</p>
<ol style="list-style-type: lower-alpha">
<li>Need to update the age of input data used in developing the current map;</li>
<li>Need for additional data collection to cover areas with high uncertainties in the current map;</li>
<li>Need for field surveys to monitor hot-spot areas in terms of salt problems;</li>
<li>Budget to cover the update cost;</li>
<li>Update focus (e.g. for prevention or control of salt problems, database management, etc.).</li>
</ol>
</div>
<div id="sampling-for-monitoring-and-gap-filling" class="section level3">
<h3><span class="header-section-number">5.4.4</span> Sampling for monitoring and gap filling</h3>
<p>One of the points to consider when planning information update is the number of locations to visit and the geographic areas to prioritize. The number of locations is determined using a simple expression such as</p>
<p><span class="math display">\[\begin{equation}
\tag{5.9}
samples = Area \times (\frac{1}{4\times w \times pixel})^2
\end{equation}\]</span></p>
<p>where pixel is the pixel size of the map, Area is the area of target site to be sampled in m<sup>2</sup>, and <span class="math inline">\(w\)</span> is the number of soil forming factors data for mapping, which is obtained from the Jenny’s soil forming factors model (Cl,O,R,P). The maximum possible number of soil-forming factors (w) is 5 (Jenny’s factors and Soil) irrespective of number of layers in each factor while the minimum number is 1. Equation (5.9) is based on the minimum legible distance (MLD) concept in soil mapping (USDA-NRCS, 1999).
The number of samples from Equation (5.9) can be allocated to the target area using available sampling protocols such as Latin hypercube sampling, random sampling, stratified random sampling (Sheikholeslami and Razavi, 2017). The function surveyPoints in the soilassessment package, which uses stratified random sampling is used to implement the sample allocation. The inputs for this function are:</p>
<ul>
<li>the map to sample;</li>
<li>number of CLORP layers used in developing the map;</li>
<li>the class in the map to sample, and the proportion of all statistically possible sample-size to target.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="country-driven-global-mapping-approach.html#cb37-1"></a><span class="co">#Step 4-1: Identifying areas to target with update # Get the summary of classes to target</span></span>
<span id="cb37-2"><a href="country-driven-global-mapping-approach.html#cb37-2"></a>predictors<span class="op">$</span>saltaffectedness=<span class="kw">classCode</span>(predictors<span class="op">$</span>Salt_affected,<span class="st">&quot;saltseverity&quot;</span>)</span>
<span id="cb37-3"><a href="country-driven-global-mapping-approach.html#cb37-3"></a><span class="kw">hist</span>(predictors<span class="op">$</span>Salt_affected, <span class="dt">main =</span> <span class="st">&quot;Topsoil salt-affected classes &quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Codes for salt-affected classes&quot;</span>)</span>
<span id="cb37-4"><a href="country-driven-global-mapping-approach.html#cb37-4"></a></span>
<span id="cb37-5"><a href="country-driven-global-mapping-approach.html#cb37-5"></a><span class="co">#Convert the summary into a dataframe for determining the proportions of each class</span></span>
<span id="cb37-6"><a href="country-driven-global-mapping-approach.html#cb37-6"></a></span>
<span id="cb37-7"><a href="country-driven-global-mapping-approach.html#cb37-7"></a>	salts=predictors[<span class="st">&quot;saltaffectedness&quot;</span>]; salts=<span class="kw">as</span>(salts,<span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb37-8"><a href="country-driven-global-mapping-approach.html#cb37-8"></a>	salts=predictors[<span class="st">&quot;saltaffectedness&quot;</span>]; salts=<span class="kw">as</span>(salts,<span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb37-9"><a href="country-driven-global-mapping-approach.html#cb37-9"></a>	salty=<span class="kw">as.data.frame</span>(salts)</span>
<span id="cb37-10"><a href="country-driven-global-mapping-approach.html#cb37-10"></a>	salty1=<span class="kw">data.frame</span>(<span class="kw">count</span>(salty<span class="op">$</span>saltaffectedness))</span>
<span id="cb37-11"><a href="country-driven-global-mapping-approach.html#cb37-11"></a>	<span class="kw">colnames</span>(salty1)=<span class="kw">c</span>(<span class="st">&quot;Saltclass&quot;</span>,<span class="st">&quot;Cases&quot;</span>)</span>
<span id="cb37-12"><a href="country-driven-global-mapping-approach.html#cb37-12"></a>	salty1<span class="op">$</span>Props=<span class="kw">round</span>(salty1<span class="op">$</span>Cases<span class="op">/</span><span class="kw">sum</span>(salty1<span class="op">$</span>Cases)<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb37-13"><a href="country-driven-global-mapping-approach.html#cb37-13"></a>	<span class="kw">barchart</span>(Saltclass<span class="op">~</span>Props, <span class="dt">data=</span>salty1, <span class="dt">xlab=</span><span class="st">&quot;Proportion (%)&quot;</span>)</span></code></pre></div>
<p>The bar plot shows the proportions of study areas dominated by the salt intensity classes. After choosing the preferred class to update, then sample points are selected and distributed in the identified class.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="country-driven-global-mapping-approach.html#cb38-1"></a><span class="co">#Step 4-2: Create number of update locations and display in the map</span></span>
<span id="cb38-2"><a href="country-driven-global-mapping-approach.html#cb38-2"></a>	predictors<span class="op">$</span>Saltclass=<span class="kw">as.numeric</span>(predictors<span class="op">$</span>saltaffectedness)</span>
<span id="cb38-3"><a href="country-driven-global-mapping-approach.html#cb38-3"></a>	salinity_LUT30=<span class="kw">classLUT</span>(predictors[<span class="st">&quot;saltaffectedness&quot;</span>],<span class="st">&quot;saltseverity&quot;</span>)</span>
<span id="cb38-4"><a href="country-driven-global-mapping-approach.html#cb38-4"></a></span>
<span id="cb38-5"><a href="country-driven-global-mapping-approach.html#cb38-5"></a>	salt_affected_class=<span class="dv">5</span></span>
<span id="cb38-6"><a href="country-driven-global-mapping-approach.html#cb38-6"></a>	clorp_factors=<span class="dv">5</span></span>
<span id="cb38-7"><a href="country-driven-global-mapping-approach.html#cb38-7"></a>	survey=<span class="kw">surveyPoints</span>(soilsample,clorp_factors,salt_affected_class,<span class="dv">10</span>)</span>
<span id="cb38-8"><a href="country-driven-global-mapping-approach.html#cb38-8"></a>	<span class="kw">length</span>(survey<span class="op">$</span>new)</span>
<span id="cb38-9"><a href="country-driven-global-mapping-approach.html#cb38-9"></a></span>
<span id="cb38-10"><a href="country-driven-global-mapping-approach.html#cb38-10"></a>[<span class="dv">1</span>] <span class="dv">33</span></span>
<span id="cb38-11"><a href="country-driven-global-mapping-approach.html#cb38-11"></a>	<span class="kw">spplot</span>(soilsample, <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">draw=</span><span class="ot">TRUE</span>),<span class="dt">sp.layout=</span><span class="kw">list</span>(<span class="st">&quot;sp.points&quot;</span>,survey,<span class="dt">pch=</span><span class="dv">8</span>,co <span class="dt">l=</span><span class="st">&quot;cyan&quot;</span>)) <span class="co"># Figure 5.18</span></span>
<span id="cb38-12"><a href="country-driven-global-mapping-approach.html#cb38-12"></a>	<span class="kw">writeOGR</span>(survey,<span class="st">&quot;.&quot;</span>,<span class="st">&quot;SurveyPointsClass5&quot;</span>,<span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figures/images/Figure5.18.PNG" alt="" />
<p class="caption">Figure 5.18: Number and placement of samples for updating</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preparation-for-multiscale-mapping-of-salt-affected-soils.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-three-information-sharing-and-resources-mobilization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/FAO-GSP/SOC-Mapping-Cookbook/edit/master/02.DEVELOPMENT_OF_INFORMATION_ON_SALT-AFFECTED_SOILS.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SASMapping.pdf", "SASMapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
